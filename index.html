<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YandexGPT - –ü–æ–º–æ—â–Ω–∏–∫ –¥–ª—è Telegram Mini App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #e5e7eb;
            --code-bg: #1e1e1e;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 80px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 20px);
        }

        header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex: 1;
            min-height: 0;
            padding: 0;
        }

        .input-panel, .output-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: hidden;
        }

        .input-panel {
            border-right: 2px solid var(--border);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .panel-header h2 {
            color: var(--dark);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .textarea-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            border: 2px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            background: var(--light);
        }

        .textarea-header {
            background: white;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .char-count {
            font-size: 0.85rem;
            color: #6b7280;
            font-family: monospace;
        }

        textarea {
            flex: 1;
            width: 100%;
            padding: 20px;
            border: none;
            font-size: 16px;
            resize: none;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            line-height: 1.5;
            background: transparent;
            min-height: 200px;
        }

        textarea:focus {
            outline: none;
        }

        .output-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--light);
            border-radius: 12px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
            border: 2px solid var(--border);
            min-height: 300px;
        }

        .output-content::-webkit-scrollbar {
            width: 8px;
        }

        .output-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .output-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .output-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .code-block {
            background: var(--code-bg);
            color: #f8f8f2;
            padding: 16px;
            border-radius: 8px;
            margin: 12px 0;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        .code-block::-webkit-scrollbar {
            height: 6px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 8px;
        }

        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 10px 16px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .preset-btn:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }

        .status-bar {
            margin-top: 15px;
            padding: 12px;
            background: #f3f4f6;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-idle .status-dot { background: var(--success); }
        .status-loading .status-dot { background: var(--warning); }
        .status-error .status-dot { background: var(--danger); }

        .token-info {
            font-family: monospace;
            font-size: 13px;
            color: #6b7280;
        }

        .actions-bottom {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .actions-bottom .btn {
            flex: 1;
            min-width: 120px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #374151;
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-success { background: var(--success); }
        .toast-error { background: var(--danger); }
        .toast-warning { background: var(--warning); }

        .history-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 30px rgba(0,0,0,0.1);
            transition: right 0.3s;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .history-panel.show {
            right: 0;
        }

        .history-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .history-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .history-item:hover {
            background: #f3f4f6;
            border-color: var(--primary);
        }

        .history-item .query {
            font-weight: 500;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-item .date {
            font-size: 12px;
            color: #6b7280;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 999;
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .ai-model-selector {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--light);
            border-radius: 8px;
            font-size: 14px;
        }

        .ai-model-selector select {
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 4px 8px;
            background: white;
            font-family: monospace;
        }

        .proxy-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 8px 16px;
            background: #f0f9ff;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 10px;
        }

        .proxy-selector select {
            border: 1px solid #93c5fd;
            border-radius: 4px;
            padding: 4px 8px;
            background: white;
            font-family: monospace;
            min-width: 200px;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .input-panel {
                border-right: none;
                border-bottom: 2px solid var(--border);
                min-height: 40vh;
            }
            
            .output-panel {
                min-height: 50vh;
            }
        }

        @media (max-width: 768px) {
            .container {
                height: calc(100vh - 10px);
                border-radius: 12px;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .panel-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .controls {
                width: 100%;
                justify-content: flex-start;
            }
            
            .preset-buttons {
                flex-direction: column;
            }
            
            .actions-bottom .btn {
                flex: none;
                width: 100%;
            }
            
            .history-panel {
                width: 100%;
                right: -100%;
            }
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .tip {
            background: #e8f5e9;
            border-left: 4px solid var(--success);
            padding: 12px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
            font-size: 14px;
        }

        .config-section {
            background: #f0f9ff;
            padding: 20px;
            border-radius: 12px;
            margin: 20px;
        }

        .config-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #93c5fd;
            border-radius: 6px;
            margin: 8px 0;
            font-family: monospace;
        }

        .config-section h3 {
            color: #1e40af;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <i class="fas fa-robot"></i>
                YandexGPT - Telegram Developer Assistant
            </h1>
            <p class="subtitle">–ë–µ–∑ CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π | –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ | –ë–µ–∑ –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã</p>
        </header>

        <!-- –°–µ–∫—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ -->
        <div class="config-section">
            <h3><i class="fas fa-cogs"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
            <div class="proxy-selector">
                <label><i class="fas fa-server"></i> –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∫—Å–∏:</label>
                <select id="proxySelect">
                    <option value="cors-anywhere">CORS Anywhere (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                    <option value="allorigins">AllOrigins Proxy</option>
                    <option value="proxycurl">ProxyCurl</option>
                    <option value="direct">–ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–¥–ª—è localhost)</option>
                </select>
            </div>
            
            <div style="margin-top: 15px;">
                <label><i class="fas fa-key"></i> –í–∞—à–∏ API –¥–∞–Ω–Ω—ã–µ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã):</label>
                <input type="text" class="config-input" value="b1gem6hvga1n872g5iug" readonly>
                <small>Folder ID (—Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å)</small>
            </div>
            
            <button class="btn btn-primary" id="testConnection" style="margin-top: 15px;">
                <i class="fas fa-plug"></i> –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            </button>
            
            <div id="connectionStatus" style="margin-top: 10px;"></div>
        </div>

        <div class="main-content">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: –í–≤–æ–¥ -->
            <div class="input-panel">
                <div class="panel-header">
                    <h2><i class="fas fa-edit"></i> –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å</h2>
                    <div class="controls">
                        <div class="ai-model-selector">
                            <i class="fas fa-brain"></i>
                            <select id="modelSelect">
                                <option value="yandexgpt-lite" selected>YandexGPT Lite</option>
                                <option value="yandexgpt">YandexGPT Pro</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary btn-icon" id="clearInput" title="–û—á–∏—Å—Ç–∏—Ç—å">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-secondary btn-icon" id="historyBtn" title="–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤">
                            <i class="fas fa-history"></i>
                        </button>
                    </div>
                </div>

                <div class="textarea-container">
                    <div class="textarea-header">
                        <span>–ó–∞–ø—Ä–æ—Å (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π!)</span>
                        <span class="char-count" id="charCount">0 —Å–∏–º–≤–æ–ª–æ–≤</span>
                    </div>
                    <textarea 
                        id="userInput" 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å –æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ Telegram Mini App...
                        
–ú–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–≤–ª—è—Ç—å –æ–≥—Ä–æ–º–Ω—ã–µ –∫—É—Å–∫–∏ –∫–æ–¥–∞ (10000+ —Å—Ç—Ä–æ–∫)!
–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –ª—é–±–æ–π –æ–±—ä–µ–º —Ç–µ–∫—Å—Ç–∞!

–ü—Ä–∏–º–µ—Ä—ã –æ–≥—Ä–æ–º–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
‚Ä¢ –í—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–Ω—ã–π –∫–æ–¥ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
‚Ä¢ –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
‚Ä¢ –ü–æ–ª—É—á–∏—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã" rows="20"></textarea>
                </div>

                <div class="preset-buttons">
                    <button class="preset-btn" data-preset="architecture">
                        <i class="fas fa-sitemap"></i> –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
                    </button>
                    <button class="preset-btn" data-preset="database">
                        <i class="fas fa-database"></i> –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
                    </button>
                    <button class="preset-btn" data-preset="payment">
                        <i class="fas fa-credit-card"></i> –ü–ª–∞—Ç–µ–∂–∏
                    </button>
                    <button class="preset-btn" data-preset="scalability">
                        <i class="fas fa-server"></i> –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
                    </button>
                    <button class="preset-btn" data-preset="security">
                        <i class="fas fa-shield-alt"></i> –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
                    </button>
                </div>

                <div class="actions-bottom">
                    <button class="btn btn-secondary" id="pasteBtn">
                        <i class="fas fa-paste"></i> –í—Å—Ç–∞–≤–∏—Ç—å
                    </button>
                    <button class="btn btn-success" id="formatBtn">
                        <i class="fas fa-code"></i> –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn btn-primary" id="sendBtn">
                        <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ YandexGPT
                    </button>
                </div>

                <div class="status-bar">
                    <div class="status-indicator status-idle" id="statusIndicator">
                        <span class="status-dot"></span>
                        <span id="statusText">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</span>
                    </div>
                    <div class="token-info" id="tokenInfo">
                        –¢–æ–∫–µ–Ω—ã: ~0
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –û—Ç–≤–µ—Ç -->
            <div class="output-panel">
                <div class="panel-header">
                    <h2><i class="fas fa-code"></i> –û—Ç–≤–µ—Ç –æ—Ç YandexGPT</h2>
                    <div class="controls">
                        <button class="btn btn-secondary btn-icon" id="copyOutput" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç">
                            <i class="far fa-copy"></i>
                        </button>
                        <button class="btn btn-secondary btn-icon" id="clearOutput" title="–û—á–∏—Å—Ç–∏—Ç—å –æ—Ç–≤–µ—Ç">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-secondary btn-icon" id="expandOutput" title="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>

                <div class="output-content" id="output"></div>

                <div class="actions-bottom">
                    <button class="btn btn-secondary" id="saveResponseBtn">
                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç
                    </button>
                    <button class="btn btn-secondary" id="exportBtn">
                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ .txt
                    </button>
                    <button class="btn btn-primary" id="continueBtn" style="display: none;">
                        <i class="fas fa-forward"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ—Ç–≤–µ—Ç
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ -->
    <div class="history-panel" id="historyPanel">
        <div class="history-header">
            <h3><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</h3>
            <button class="btn btn-icon" id="closeHistory">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="history-content" id="historyContent">
            <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </div>
    </div>

    <!-- Overlay –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ -->
    <div class="overlay" id="historyOverlay"></div>

    <!-- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="toast" class="toast"></div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø YANDEXGPT ====================
        const YANDEX_CONFIG = {
            folderId: "b1gem6hvga1n872g5iug",
            apiKey: "AQVNxxfO7thv4q0zZt_tYo2gBHQfVRCz_oTgPO8B",
            keyId: "aje72v7etm3fsamj6pmv"
        };

        // ==================== –ü–†–û–ö–°–ò –°–ï–†–í–ï–†–´ (—Ä–µ—à–µ–Ω–∏–µ CORS –ø—Ä–æ–±–ª–µ–º—ã) ====================
        const PROXY_SERVERS = {
            'cors-anywhere': 'https://cors-anywhere.herokuapp.com/',
            'allorigins': 'https://api.allorigins.win/raw?url=',
            'proxycurl': 'https://corsproxy.io/?',
            'direct': ''
        };

        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –æ–¥–∏–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
        const BACKUP_PROXIES = [
            'https://corsproxy.org/?',
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://thingproxy.freeboard.io/fetch/'
        ];

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        const state = {
            isProcessing: false,
            currentResponse: "",
            history: [],
            conversationContext: [],
            currentProxyIndex: 0,
            proxies: [...BACKUP_PROXIES, PROXY_SERVERS['cors-anywhere'], PROXY_SERVERS['allorigins']]
        };

        // ==================== DOM –≠–õ–ï–ú–ï–ù–¢–´ ====================
        const elements = {
            userInput: document.getElementById('userInput'),
            output: document.getElementById('output'),
            sendBtn: document.getElementById('sendBtn'),
            copyOutputBtn: document.getElementById('copyOutput'),
            clearInputBtn: document.getElementById('clearInput'),
            clearOutputBtn: document.getElementById('clearOutput'),
            pasteBtn: document.getElementById('pasteBtn'),
            formatBtn: document.getElementById('formatBtn'),
            charCount: document.getElementById('charCount'),
            statusIndicator: document.getElementById('statusIndicator'),
            statusText: document.getElementById('statusText'),
            tokenInfo: document.getElementById('tokenInfo'),
            modelSelect: document.getElementById('modelSelect'),
            historyBtn: document.getElementById('historyBtn'),
            historyPanel: document.getElementById('historyPanel'),
            historyContent: document.getElementById('historyContent'),
            closeHistory: document.getElementById('closeHistory'),
            historyOverlay: document.getElementById('historyOverlay'),
            toast: document.getElementById('toast'),
            saveResponseBtn: document.getElementById('saveResponseBtn'),
            exportBtn: document.getElementById('exportBtn'),
            continueBtn: document.getElementById('continueBtn'),
            expandOutput: document.getElementById('expandOutput'),
            proxySelect: document.getElementById('proxySelect'),
            testConnection: document.getElementById('testConnection'),
            connectionStatus: document.getElementById('connectionStatus')
        };

        // ==================== –ü–†–ï–°–ï–¢–´ –î–õ–Ø –ë–û–õ–¨–®–ò–• –ó–ê–ü–†–û–°–û–í ====================
        const PRESETS = {
            architecture: `–°–æ–∑–¥–∞–π –ø–æ–ª–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ Telegram Mini App –≤–∫–ª—é—á–∞—è –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–µ–ø–ª–æ–π. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –ø–æ–ª–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã, –¥–∏–∞–≥—Ä–∞–º–º—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.`,
            
            database: `–†–∞–∑—Ä–∞–±–æ—Ç–∞–π –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –º–∏–ª–ª–∏–æ–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –í–∫–ª—é—á–∏ –º–∏–≥—Ä–∞—Ü–∏–∏, –∏–Ω–¥–µ–∫—Å—ã, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é, —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±—ç–∫–∞–ø–æ–≤.`,
            
            payment: `–†–µ–∞–ª–∏–∑—É–π –ø–æ–ª–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø–ª–∞—Ç–µ–∂–µ–π —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ÆKassa, Stripe –∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç. –í–∫–ª—é—á–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –≤–µ–±—Ö—É–∫–∏, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.`,
            
            scalability: `–ü—Ä–µ–¥–ª–æ–∂–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫—É –≤ 100–∫ RPS.`,
            
            security: `–†–∞–∑—Ä–∞–±–æ—Ç–∞–π –ø–æ–ª–Ω—ã–π security audit –ø–ª–∞–Ω –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è penetration testing, vulnerability scanning –∏ incident response.`
        };

        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        function showToast(message, type = 'info', duration = 3000) {
            elements.toast.textContent = message;
            elements.toast.className = 'toast';
            elements.toast.classList.add(`toast-${type}`, 'show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, duration);
        }

        function updateStatus(text, type = 'idle') {
            elements.statusIndicator.className = `status-indicator status-${type}`;
            elements.statusText.textContent = text;
        }

        function updateCharCount() {
            const length = elements.userInput.value.length;
            elements.charCount.textContent = `${length} —Å–∏–º–≤–æ–ª–æ–≤`;
            
            // –†–∞—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤
            const estimatedTokens = Math.ceil(length / 3);
            elements.tokenInfo.textContent = `–¢–æ–∫–µ–Ω—ã: ~${estimatedTokens}`;
        }

        function formatCodeInResponse(text) {
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
            text = text.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                const language = lang || 'javascript';
                return `<div class="code-block" data-language="${language}">${code.trim()}</div>`;
            });
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ inline –∫–æ–¥–∞
            text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏
            text = text.replace(/^### (.+)$/gm, '<h3>$1</h3>');
            text = text.replace(/^## (.+)$/gm, '<h2>$1</h2>');
            text = text.replace(/^# (.+)$/gm, '<h1>$1</h1>');
            
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            text = text.replace(/^---$/gm, '<hr>');
            text = text.replace(/^\*\*\*$/gm, '<hr>');
            
            // –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            
            // –ö—É—Ä—Å–∏–≤
            text = text.replace(/\*(.+?)\*/g, '<em>$1</em>');
            
            // –°–ø–∏—Å–∫–∏
            text = text.replace(/^\* (.+)$/gm, '<li>$1</li>');
            text = text.replace(/^\- (.+)$/gm, '<li>$1</li>');
            text = text.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');
            
            // –ê–±–∑–∞—Ü—ã
            text = text.replace(/\n\n/g, '</p><p>');
            text = text.replace(/\n/g, '<br>');
            
            return `<p>${text}</p>`;
        }

        // ==================== –ü–†–û–ö–°–ò –†–ï–®–ï–ù–ò–ï –î–õ–Ø CORS ====================
        async function callYandexGPTWithProxy(query, proxyUrl) {
            const model = elements.modelSelect.value;
            
            const requestBody = {
                modelUri: `gpt://${YANDEX_CONFIG.folderId}/${model}`,
                completionOptions: {
                    stream: false,
                    temperature: 0.3,
                    maxTokens: 8000  // –£–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤
                },
                messages: [
                    {
                        role: "system",
                        text: `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ Telegram Mini Apps. –û—Ç–≤–µ—á–∞–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ –∏ –ø–æ–ª–Ω–æ. 
–ù–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π —Ä–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π –ø–æ–ª–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –±–æ–ª—å—à–∏–µ. 
–ò—Å–ø–æ–ª—å–∑—É–π markdown –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –†–∞–∑–±–∏–≤–∞–π —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã –Ω–∞ —Å–µ–∫—Ü–∏–∏ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.`
                    },
                    {
                        role: "user",
                        text: query
                    }
                ]
            };
            
            const yandexUrl = 'https://llm.api.cloud.yandex.net/foundationModels/v1/completion';
            const targetUrl = proxyUrl ? proxyUrl + encodeURIComponent(yandexUrl) : yandexUrl;
            
            console.log('Using proxy:', proxyUrl || 'Direct');
            console.log('Target URL:', targetUrl);
            
            try {
                const response = await fetch(targetUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Api-Key ${YANDEX_CONFIG.apiKey}`,
                        'x-folder-id': YANDEX_CONFIG.folderId,
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(requestBody),
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
                
            } catch (error) {
                console.error('Proxy error:', error);
                throw error;
            }
        }

        async function callYandexGPT(query) {
            if (state.isProcessing) return null;
            
            state.isProcessing = true;
            updateStatus('–û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏...', 'loading');
            
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏
            const maxRetries = state.proxies.length;
            
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                const proxyUrl = state.proxies[(state.currentProxyIndex + attempt) % state.proxies.length];
                
                try {
                    console.log(`Attempt ${attempt + 1} with proxy:`, proxyUrl || 'Direct');
                    
                    const data = await callYandexGPTWithProxy(query, proxyUrl);
                    
                    // –£—Å–ø–µ—Ö - –∑–∞–ø–æ–º–∏–Ω–∞–µ–º —ç—Ç–æ—Ç –ø—Ä–æ–∫—Å–∏
                    state.currentProxyIndex = (state.currentProxyIndex + attempt) % state.proxies.length;
                    
                    if (data.result && data.result.alternatives && data.result.alternatives[0]) {
                        return data.result.alternatives[0].message.text;
                    } else {
                        throw new Error('Invalid response format');
                    }
                    
                } catch (error) {
                    console.error(`Proxy attempt ${attempt + 1} failed:`, error);
                    
                    if (attempt === maxRetries - 1) {
                        // –í—Å–µ –ø—Ä–æ–∫—Å–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏
                        throw new Error(`All proxies failed. Last error: ${error.message}`);
                    }
                    
                    // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }
            
            throw new Error('No working proxy found');
        }

        // ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ====================
        elements.userInput.addEventListener('input', updateCharCount);
        
        elements.sendBtn.addEventListener('click', async () => {
            const query = elements.userInput.value.trim();
            if (!query) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å!', 'error');
                return;
            }
            
            try {
                updateStatus('–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏...', 'loading');
                elements.continueBtn.style.display = 'none';
                
                const response = await callYandexGPT(query);
                const formattedResponse = formatCodeInResponse(response);
                
                elements.output.innerHTML = formattedResponse;
                state.currentResponse = response;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                const historyItem = {
                    id: Date.now(),
                    query: query.substring(0, 200) + (query.length > 200 ? '...' : ''),
                    fullQuery: query,
                    response: response.substring(0, 500) + (response.length > 500 ? '...' : ''),
                    fullResponse: response,
                    timestamp: new Date().toLocaleString('ru-RU'),
                    model: elements.modelSelect.value
                };
                
                state.history.unshift(historyItem);
                state.history = state.history.slice(0, 50);
                localStorage.setItem('yandexgpt_history', JSON.stringify(state.history));
                updateHistoryDisplay();
                
                updateStatus('–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω!', 'idle');
                showToast('–û—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏!', 'success', 4000);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                if (response.length > 3000) {
                    elements.continueBtn.style.display = 'inline-flex';
                }
                
            } catch (error) {
                console.error('Final error:', error);
                
                // Fallback: –¥–µ–º–æ-–æ—Ç–≤–µ—Ç —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
                elements.output.innerHTML = `<div class="tip">
                    <strong>‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ YandexGPT</strong><br><br>
                    <strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> ${error.message}<br><br>
                    <strong>–†–µ—à–µ–Ω–∏–µ:</strong><br>
                    1. <strong>–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</strong> (F5)<br>
                    2. <strong>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø—Ä–æ–∫—Å–∏</strong> –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö<br>
                    3. <strong>–û—Ç–∫–ª—é—á–∏—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫ —Ä–µ–∫–ª–∞–º—ã</strong> (uBlock, AdBlock)<br>
                    4. <strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤</strong><br><br>
                    
                    <strong>–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:</strong><br>
                    <button class="btn btn-primary" id="useDemo" style="margin: 10px 0;">
                        <i class="fas fa-magic"></i> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–º–æ-—Ä–µ–∂–∏–º
                    </button>
                    
                    <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ API:</strong><br>
                    ‚Ä¢ Folder ID: ${YANDEX_CONFIG.folderId}<br>
                    ‚Ä¢ API Key: ${YANDEX_CONFIG.apiKey.substring(0, 20)}...<br>
                    ‚Ä¢ Key ID: ${YANDEX_CONFIG.keyId}
                </div>`;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞
                setTimeout(() => {
                    const demoBtn = document.getElementById('useDemo');
                    if (demoBtn) {
                        demoBtn.addEventListener('click', () => {
                            const demoResponse = `# –î–µ–º–æ-–æ—Ç–≤–µ—Ç YandexGPT

## üì± Telegram Mini App –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
\`\`\`html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div id="app"></div>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        
        // –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const app = {
            init() {
                this.user = Telegram.WebApp.initDataUnsafe.user;
                this.render();
            },
            
            render() {
                document.getElementById('app').innerHTML = \`
                    <h1>–ü—Ä–∏–≤–µ—Ç, \${this.user?.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}!</h1>
                    <button onclick="Telegram.WebApp.sendData('hello')">
                        –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                \`;
            }
        };
        
        app.init();
    </script>
</body>
</html>
\`\`\`

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram
\`\`\`javascript
// –í–∞–ª–∏–¥–∞—Ü–∏—è initData
function validateInitData(initData) {
    const params = new URLSearchParams(initData);
    const hash = params.get('hash');
    params.delete('hash');
    
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    const sortedParams = Array.from(params.entries())
        .sort(([a], [b]) => a.localeCompare(b))
        .map(([k, v]) => \`\${k}=\${v}\`)
        .join('\\n');
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
    const secretKey = crypto.createHmac('sha256', 'WebAppData')
        .update(process.env.BOT_TOKEN);
    
    const calculatedHash = crypto
        .createHmac('sha256', secretKey)
        .update(sortedParams)
        .digest('hex');
    
    return calculatedHash === hash;
}
\`\`\`

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–æ—Ç–æ–º
\`\`\`javascript
class TelegramAPI {
    constructor(botToken) {
        this.baseUrl = \`https://api.telegram.org/bot\${botToken}\`;
    }
    
    async sendMessage(chatId, text, options = {}) {
        const response = await fetch(\`\${this.baseUrl}/sendMessage\`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: chatId,
                text,
                parse_mode: 'HTML',
                ...options
            })
        });
        
        return await response.json();
    }
    
    async answerCallbackQuery(callbackQueryId, text) {
        const response = await fetch(\`\${this.baseUrl}/answerCallbackQuery\`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                callback_query_id: callbackQueryId,
                text,
                show_alert: true
            })
        });
        
        return await response.json();
    }
}
\`\`\`

### 4. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
\`\`\`yaml
# docker-compose.yml
version: '3.8'
services:
  webapp:
    build: ./frontend
    ports:
      - "3000:80"
    environment:
      - API_URL=http://backend:3001
      
  backend:
    build: ./backend
    ports:
      - "3001:3001"
    environment:
      - DATABASE_URL=postgres://user:pass@db:5432/app
      - REDIS_URL=redis://redis:6379
      
  db:
    image: postgres:14
    environment:
      - POSTGRES_DB=app
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    volumes:
      - postgres_data:/var/lib/postgresql/data
      
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
\`\`\`

### 5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
\`\`\`javascript
// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Redis
const redis = require('redis');
const client = redis.createClient();

async function getCachedUserData(userId) {
    const cacheKey = \`user:\${userId}\`;
    const cached = await client.get(cacheKey);
    
    if (cached) {
        return JSON.parse(cached);
    }
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    const userData = await db.users.findUnique({
        where: { id: userId },
        include: { settings: true }
    });
    
    // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 5 –º–∏–Ω—É—Ç
    await client.setEx(cacheKey, 300, JSON.stringify(userData));
    
    return userData;
}
\`\`\`

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ –¥–µ–º–æ-–æ—Ç–≤–µ—Ç. –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å YandexGPT –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏.`;
                            
                            elements.output.innerHTML = formatCodeInResponse(demoResponse);
                            state.currentResponse = demoResponse;
                            showToast('–ó–∞–≥—Ä—É–∂–µ–Ω –¥–µ–º–æ-—Ä–µ–∂–∏–º', 'warning');
                        });
                    }
                }, 100);
                
                updateStatus('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
                showToast('–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–∫—Å–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä.', 'error', 5000);
            } finally {
                state.isProcessing = false;
            }
        });
        
        // –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        elements.testConnection.addEventListener('click', async () => {
            updateStatus('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏...', 'loading');
            
            const testQuery = "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.";
            const selectedProxy = elements.proxySelect.value;
            const proxyUrl = PROXY_SERVERS[selectedProxy] || '';
            
            try {
                const data = await callYandexGPTWithProxy(testQuery, proxyUrl);
                
                elements.connectionStatus.innerHTML = `
                    <div class="status-indicator status-idle">
                        <span class="status-dot"></span>
                        –ü—Ä–æ–∫—Å–∏ "${selectedProxy}" —Ä–∞–±–æ—Ç–∞–µ—Ç! –°—Ç–∞—Ç—É—Å: OK
                    </div>
                `;
                
                showToast(`–ü—Ä–æ–∫—Å–∏ "${selectedProxy}" —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!`, 'success');
                updateStatus('–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'idle');
                
            } catch (error) {
                elements.connectionStatus.innerHTML = `
                    <div class="status-indicator status-error">
                        <span class="status-dot"></span>
                        –ü—Ä–æ–∫—Å–∏ "${selectedProxy}" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}
                    </div>
                `;
                
                showToast(`–ü—Ä–æ–∫—Å–∏ "${selectedProxy}" –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω`, 'error');
                updateStatus('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞', 'error');
            }
        });

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π...
        elements.continueBtn.addEventListener('click', async () => {
            if (!state.currentResponse) return;
            
            try {
                updateStatus('–ü—Ä–æ–¥–æ–ª–∂–∞—é –æ—Ç–≤–µ—Ç...', 'loading');
                
                const continuationQuery = `–ü—Ä–æ–¥–æ–ª–∂–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ, –¥–æ–±–∞–≤—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è.`;
                const response = await callYandexGPT(continuationQuery);
                const formattedResponse = formatCodeInResponse(response);
                
                elements.output.innerHTML += '<hr style="margin: 20px 0; border-color: #e5e7eb;">' + formattedResponse;
                state.currentResponse += '\n\n' + response;
                
                updateStatus('–û—Ç–≤–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω', 'idle');
                showToast('–û—Ç–≤–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω!', 'success');
                
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞', 'error');
                updateStatus('–û—à–∏–±–∫–∞', 'error');
            }
        });
        
        elements.copyOutputBtn.addEventListener('click', () => {
            const text = elements.output.innerText || state.currentResponse;
            navigator.clipboard.writeText(text).then(() => {
                showToast('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä!', 'success');
            });
        });
        
        elements.clearInputBtn.addEventListener('click', () => {
            elements.userInput.value = '';
            updateCharCount();
            showToast('–ü–æ–ª–µ –≤–≤–æ–¥–∞ –æ—á–∏—â–µ–Ω–æ', 'info');
        });
        
        elements.clearOutputBtn.addEventListener('click', () => {
            elements.output.innerHTML = '';
            state.currentResponse = '';
            elements.continueBtn.style.display = 'none';
            showToast('–û—Ç–≤–µ—Ç –æ—á–∏—â–µ–Ω', 'info');
        });
        
        elements.pasteBtn.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                elements.userInput.value = text;
                updateCharCount();
                showToast('–¢–µ–∫—Å—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω –∏–∑ –±—É—Ñ–µ—Ä–∞', 'success');
            } catch (err) {
                showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç', 'error');
            }
        });
        
        elements.formatBtn.addEventListener('click', () => {
            const text = elements.userInput.value;
            
            // –ü—Ä–æ—Å—Ç–æ–µ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–æ–¥–∞
            if (text.includes('function') || text.includes('const ') || text.includes('import ')) {
                elements.userInput.value = text
                    .replace(/{/g, '{\n    ')
                    .replace(/}/g, '\n}')
                    .replace(/;/g, ';\n')
                    .replace(/,/g, ',\n    ');
                showToast('–ö–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
            } else {
                showToast('–≠—Ç–æ –Ω–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–æ–¥ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'info');
            }
            
            updateCharCount();
        });
        
        // –ü—Ä–µ—Å–µ—Ç –∫–Ω–æ–ø–∫–∏
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const preset = btn.dataset.preset;
                if (PRESETS[preset]) {
                    elements.userInput.value = PRESETS[preset];
                    updateCharCount();
                    showToast(`–ó–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–µ—Å–µ—Ç: ${btn.textContent.trim()}`, 'success');
                    elements.userInput.focus();
                }
            });
        });
        
        // –ò—Å—Ç–æ—Ä–∏—è (—Ñ—É–Ω–∫—Ü–∏–∏)
        function updateHistoryDisplay() {
            elements.historyContent.innerHTML = state.history.map(item => `
                <div class="history-item" data-id="${item.id}">
                    <div class="query">${item.query}</div>
                    <div class="date">${item.timestamp} ‚Ä¢ ${item.model}</div>
                </div>
            `).join('');
        }
        
        function loadHistory() {
            const saved = localStorage.getItem('yandexgpt_history');
            if (saved) {
                state.history = JSON.parse(saved);
                updateHistoryDisplay();
            }
        }
        
        elements.historyBtn.addEventListener('click', () => {
            elements.historyPanel.classList.add('show');
            elements.historyOverlay.classList.add('show');
        });
        
        elements.closeHistory.addEventListener('click', () => {
            elements.historyPanel.classList.remove('show');
            elements.historyOverlay.classList.remove('show');
        });
        
        elements.historyOverlay.addEventListener('click', () => {
            elements.historyPanel.classList.remove('show');
            elements.historyOverlay.classList.remove('show');
        });
        
        elements.historyContent.addEventListener('click', (e) => {
            const historyItem = e.target.closest('.history-item');
            if (historyItem) {
                const id = parseInt(historyItem.dataset.id);
                const item = state.history.find(h => h.id === id);
                if (item) {
                    elements.userInput.value = item.fullQuery;
                    elements.output.innerHTML = formatCodeInResponse(item.fullResponse);
                    state.currentResponse = item.fullResponse;
                    updateCharCount();
                    showToast('–ó–∞–ø—Ä–æ—Å –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏', 'success');
                    
                    elements.historyPanel.classList.remove('show');
                    elements.historyOverlay.classList.remove('show');
                }
            }
        });
        
        elements.saveResponseBtn.addEventListener('click', () => {
            if (!state.currentResponse) {
                showToast('–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
                return;
            }
            
            const blob = new Blob([state.currentResponse], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `yandexgpt-response-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('–û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ñ–∞–π–ª!', 'success');
        });
        
        elements.exportBtn.addEventListener('click', () => {
            const content = `–ó–∞–ø—Ä–æ—Å: ${elements.userInput.value}\n\n${'='.repeat(50)}\n\n–û—Ç–≤–µ—Ç:\n${state.currentResponse}`;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `telegram-dev-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!', 'success');
        });
        
        elements.expandOutput.addEventListener('click', () => {
            if (elements.output.style.position === 'fixed') {
                elements.output.style.position = '';
                elements.output.style.top = '';
                elements.output.style.left = '';
                elements.output.style.width = '';
                elements.output.style.height = '';
                elements.output.style.zIndex = '';
                elements.output.style.background = '';
                showToast('–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç–∫–ª—é—á–µ–Ω', 'info');
            } else {
                elements.output.style.position = 'fixed';
                elements.output.style.top = '0';
                elements.output.style.left = '0';
                elements.output.style.width = '100vw';
                elements.output.style.height = '100vh';
                elements.output.style.zIndex = '1001';
                elements.output.style.background = 'white';
                elements.output.style.padding = '40px';
                showToast('–†–µ–∂–∏–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞', 'success');
            }
        });
        
        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter' && !state.isProcessing) {
                e.preventDefault();
                elements.sendBtn.click();
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 's' && state.currentResponse) {
                e.preventDefault();
                elements.saveResponseBtn.click();
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'h') {
                e.preventDefault();
                elements.historyBtn.click();
            }
            
            if (e.key === 'Escape' && elements.output.style.position === 'fixed') {
                elements.expandOutput.click();
            }
        });

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        function init() {
            updateCharCount();
            loadHistory();
            
            elements.output.innerHTML = `<div class="tip">
                <strong>üöÄ YandexGPT –ø–æ–º–æ—â–Ω–∏–∫ –≥–æ—Ç–æ–≤!</strong><br><br>
                ‚úÖ <strong>–ü—Ä–æ–∫—Å–∏-—Ä–µ—à–µ–Ω–∏–µ</strong> –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS<br>
                ‚úÖ <strong>–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</strong> –Ω–∞ —Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤<br>
                ‚úÖ <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä</strong> —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ–∫—Å–∏<br>
                ‚úÖ <strong>–î–µ–º–æ-—Ä–µ–∂–∏–º</strong> –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º<br><br>
                <strong>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong><br>
                1. –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä—ã<br>
                2. –ï—Å–ª–∏ –æ–¥–∏–Ω –ø—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π<br>
                3. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —à–∏—Ñ—Ä—É—é—Ç—Å—è –∏ –∑–∞—â–∏—â–µ–Ω—ã<br>
                4. –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ<br><br>
                <strong>–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:</strong><br>
                ‚Ä¢ Ctrl+Enter - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å<br>
                ‚Ä¢ Ctrl+S - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç<br>
                ‚Ä¢ Ctrl+H - –æ—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é<br>
                ‚Ä¢ Esc - –≤—ã–π—Ç–∏ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞<br><br>
                <em>–ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è" —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∫—Å–∏</em>
            </div>`;
            
            showToast('–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–∫—Å–∏!', 'success', 5000);
            console.log('Initialized with config:', YANDEX_CONFIG);
            console.log('Available proxies:', state.proxies);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        init();
    </script>
</body>
</html>
