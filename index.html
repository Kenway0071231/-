<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNEAKER VAULT | Original Nike Sneakers</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* ===== –í–°–ï –°–¢–ò–õ–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô ===== */
        :root {
            --primary: #111111;
            --secondary: #FF6B35;
            --light: #FFFFFF;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --info: #3B82F6;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --radius-sm: 0.375rem;
            --radius: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.25rem;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--light);
            color: var(--gray-900);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.5;
            overflow-x: hidden;
        }

        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--gray-900) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loader-container {
            width: 120px;
            height: 120px;
            position: relative;
            margin-bottom: 2rem;
        }

        .loader-square {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
        }

        .loader-fill {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 0%;
            height: calc(100% - 6px);
            background: var(--secondary);
            border-radius: var(--radius-sm);
            animation: fillLoader 1.5s ease-in-out forwards;
        }

        .loader-progress {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--light);
            z-index: 2;
        }

        @keyframes fillLoader {
            0% { width: 0%; }
            100% { width: calc(100% - 6px); }
        }

        .loader-text {
            font-size: 1rem;
            font-weight: 600;
            color: var(--light);
            letter-spacing: 0.05em;
            margin-top: 1rem;
            text-align: center;
            line-height: 1.4;
        }

        #app {
            min-height: 100vh;
            padding-bottom: 5rem;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* ===== HEADER ===== */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--light);
            border-bottom: 1px solid var(--gray-200);
            padding: 0.75rem 1rem;
            backdrop-filter: blur(8px);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 80rem;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .logo-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--gray-900) 100%);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon i {
            font-size: 1.25rem;
            color: var(--light);
        }

        .logo-text {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .logo-title {
            font-size: 1.25rem;
            font-weight: 900;
            color: var(--primary);
            letter-spacing: -0.025em;
        }

        .logo-subtitle {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--gray-500);
            letter-spacing: 0.05em;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .icon-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: var(--radius-full);
            border: none;
            background: var(--gray-100);
            color: var(--gray-700);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .icon-btn:hover {
            background: var(--gray-200);
            color: var(--primary);
            transform: translateY(-1px);
        }

        .badge {
            position: absolute;
            top: -0.25rem;
            right: -0.25rem;
            background: var(--secondary);
            color: var(--light);
            font-size: 0.625rem;
            font-weight: 700;
            min-width: 1.125rem;
            height: 1.125rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 0.25rem;
            box-shadow: var(--shadow);
        }

        /* ===== –§–ò–õ–¨–¢–†–´ ===== */
        .filters-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: flex-end;
            padding: 0;
            animation: fadeIn 0.2s ease;
        }

        .filters-modal.active {
            display: flex;
        }

        .filters-content {
            background: var(--light);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            width: 100%;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .filters-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .filters-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .filters-close {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: var(--radius);
            border: none;
            background: var(--gray-100);
            color: var(--gray-600);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .filters-close:hover {
            background: var(--gray-200);
            color: var(--primary);
        }

        .filters-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
            max-height: calc(85vh - 150px);
        }

        .search-filter-container {
            margin-bottom: 1.5rem;
        }

        .search-filter-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 0.875rem;
            transition: var(--transition);
            font-family: inherit;
        }

        .search-filter-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .filter-group {
            margin-bottom: 1.5rem;
        }

        .filter-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .filter-option {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-full);
            background: var(--light);
            color: var(--gray-700);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .filter-option:hover {
            border-color: var(--gray-300);
            background: var(--gray-50);
        }

        .filter-option.active {
            background: var(--primary);
            color: var(--light);
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .price-range-container {
            padding: 1rem 0;
        }

        .range-slider {
            position: relative;
            height: 40px;
            display: flex;
            align-items: center;
        }

        .range-track {
            position: absolute;
            height: 4px;
            background: var(--gray-200);
            border-radius: 2px;
            width: 100%;
        }

        .range-selected {
            position: absolute;
            height: 4px;
            background: var(--primary);
            border-radius: 2px;
        }

        .range-input {
            position: absolute;
            width: 100%;
            height: 100%;
            background: none;
            pointer-events: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .range-input::-webkit-slider-thumb {
            pointer-events: auto;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid var(--light);
            box-shadow: var(--shadow-md);
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
        }

        .range-input::-moz-range-thumb {
            pointer-events: auto;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid var(--light);
            box-shadow: var(--shadow-md);
            cursor: pointer;
        }

        .price-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .price-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .price-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .filters-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 0.75rem;
            flex-shrink: 0;
            background: var(--light);
            position: sticky;
            bottom: 0;
        }

        /* ===== MAIN CONTENT ===== */
        .content {
            max-width: 80rem;
            margin: 0 auto;
            padding: 1.5rem 1rem;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title {
            font-size: 1.875rem;
            font-weight: 900;
            color: var(--primary);
            letter-spacing: -0.025em;
        }

        .filter-toggle {
            padding: 0.625rem 1.25rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-full);
            background: var(--light);
            color: var(--gray-700);
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-toggle:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .filter-toggle i {
            font-size: 1rem;
        }

        .results-counter {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .results-counter i {
            color: var(--gray-400);
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            min-height: 2rem;
        }

        .active-filter {
            padding: 0.375rem 0.75rem;
            background: var(--primary);
            color: var(--light);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .clear-filters {
            padding: 0.375rem 0.75rem;
            background: var(--gray-100);
            color: var(--gray-600);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .clear-filters:hover {
            background: var(--gray-200);
            color: var(--primary);
        }

        /* ===== PRODUCTS GRID ===== */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 640px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
            }
        }

        @media (min-width: 1024px) {
            .products-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1280px) {
            .products-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .product-card {
            background: var(--light);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--gray-200);
            transition: var(--transition);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-0.25rem);
            border-color: var(--gray-300);
            box-shadow: var(--shadow-lg);
        }

        .product-image {
            position: relative;
            height: 16rem;
            overflow: hidden;
            background: var(--gray-100);
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-badges {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            right: 0.75rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            z-index: 10;
        }

        .product-badge {
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-full);
            font-size: 0.625rem;
            font-weight: 700;
            letter-spacing: 0.025em;
        }

        .badge-new {
            background: var(--primary);
            color: var(--light);
        }

        .badge-exclusive {
            background: #8B5CF6;
            color: var(--light);
        }

        .badge-discount {
            background: var(--success);
            color: var(--light);
        }

        .badge-stock {
            background: var(--light);
            color: var(--primary);
            box-shadow: var(--shadow);
        }

        .badge-stock.low {
            background: var(--warning);
            color: var(--light);
        }

        .badge-stock.out {
            background: var(--gray-400);
            color: var(--light);
        }

        .favorite-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            width: 2.25rem;
            height: 2.25rem;
            border-radius: 50%;
            background: var(--light);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-400);
            cursor: pointer;
            transition: var(--transition);
            z-index: 10;
            box-shadow: var(--shadow);
        }

        .favorite-btn:hover {
            color: var(--error);
            transform: scale(1.1);
        }

        .favorite-btn.active {
            color: var(--error);
        }

        .product-info {
            padding: 1rem;
        }

        .product-category {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .product-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-900);
            line-height: 1.4;
            margin-bottom: 0.5rem;
            height: 2.8em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-price-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .product-price {
            display: flex;
            flex-direction: column;
        }

        .original-price {
            font-size: 0.875rem;
            color: var(--gray-400);
            text-decoration: line-through;
        }

        .current-price {
            font-size: 1.125rem;
            font-weight: 800;
            color: var(--primary);
        }

        .discount-percent {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--success);
            background: rgba(16, 185, 129, 0.1);
            padding: 0.125rem 0.375rem;
            border-radius: var(--radius-sm);
            margin-left: 0.5rem;
        }

        .add-to-cart {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .add-to-cart:hover {
            background: var(--gray-800);
            transform: scale(1.05);
        }

        .add-to-cart:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
            transform: none;
        }

        .product-sizes {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }

        .size-tag {
            padding: 0.125rem 0.375rem;
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            font-size: 0.625rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        /* ===== BUTTONS ===== */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--light);
        }

        .btn-primary:hover {
            background: var(--gray-800);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
        }

        .btn-block {
            width: 100%;
        }

        /* ===== NAVIGATION ===== */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--light);
            border-top: 1px solid var(--gray-200);
            padding: 0.75rem;
            z-index: 100;
            backdrop-filter: blur(8px);
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            max-width: 80rem;
            margin: 0 auto;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.75rem 0.5rem;
            border: none;
            background: transparent;
            border-radius: var(--radius);
            color: var(--gray-500);
            cursor: pointer;
            transition: var(--transition);
        }

        .nav-btn i {
            font-size: 1.25rem;
            transition: var(--transition);
        }

        .nav-btn span {
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 0.025em;
        }

        .nav-btn:hover {
            color: var(--primary);
            background: var(--gray-50);
        }

        .nav-btn.active {
            color: var(--primary);
            background: var(--gray-100);
        }

        /* ===== CART PAGE ===== */
        .cart-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--light);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            margin-bottom: 0.75rem;
        }

        .cart-item-image {
            width: 5rem;
            height: 5rem;
            border-radius: var(--radius);
            overflow: hidden;
            flex-shrink: 0;
        }

        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cart-item-info {
            flex: 1;
            min-width: 0;
        }

        .cart-item-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .cart-item-price {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--gray-100);
            border-radius: var(--radius-full);
            padding: 0.25rem;
        }

        .qty-btn {
            width: 1.75rem;
            height: 1.75rem;
            border-radius: 50%;
            background: var(--light);
            border: none;
            color: var(--gray-700);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-weight: 600;
        }

        .qty-btn:hover {
            background: var(--primary);
            color: var(--light);
        }

        .qty-value {
            min-width: 1.5rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .remove-btn {
            width: 2.25rem;
            height: 2.25rem;
            border-radius: 50%;
            background: var(--gray-100);
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .remove-btn:hover {
            background: var(--error);
            color: var(--light);
        }

        .cart-summary {
            background: var(--light);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .summary-row:last-child {
            border-bottom: none;
            font-weight: 800;
            font-size: 1.25rem;
            padding-top: 1rem;
        }

        /* ===== –û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê ===== */
        .checkout-form {
            background: var(--light);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ===== –ü–†–û–§–ò–õ–¨ ===== */
        .profile-section {
            background: var(--light);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .order-card {
            padding: 1rem;
            background: var(--gray-50);
            border-radius: var(--radius);
            border: 1px solid var(--gray-200);
            margin-bottom: 0.75rem;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .order-number {
            font-weight: 700;
            color: var(--primary);
        }

        .order-status {
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .order-items {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: 0.5rem;
        }

        .order-total {
            font-weight: 600;
            color: var(--primary);
        }

        /* ===== EMPTY STATES ===== */
        .empty-state {
            text-align: center;
            padding: 4rem 1rem;
        }

        .empty-icon {
            font-size: 3.5rem;
            color: var(--gray-300);
            margin-bottom: 1.5rem;
        }

        .empty-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .empty-description {
            color: var(--gray-600);
            max-width: 24rem;
            margin: 0 auto 1.5rem;
        }

        .profile-header {
            text-align: center;
            padding: 2rem;
            background: var(--light);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            margin-bottom: 1.5rem;
        }

        .profile-avatar {
            width: 5rem;
            height: 5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--gray-800) 100%);
            color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            margin: 0 auto 1rem;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .profile-username {
            color: var(--gray-600);
            margin-bottom: 1rem;
        }

        /* ===== –ù–ê–°–¢–†–û–ô–ö–ò ===== */
        .settings-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--light);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .settings-option:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        .settings-option-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .settings-option-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: var(--radius);
            background: var(--gray-100);
            color: var(--gray-600);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
        }

        .settings-option-text {
            display: flex;
            flex-direction: column;
        }

        .settings-option-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .settings-option-description {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .toggle-switch {
            position: relative;
            width: 3rem;
            height: 1.5rem;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-300);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 1.125rem;
            width: 1.125rem;
            left: 0.1875rem;
            bottom: 0.1875rem;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--success);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(1.5rem);
        }

        /* ===== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ===== */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .settings-modal.active {
            display: flex;
        }

        .settings-modal-content {
            background: var(--light);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 28rem;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
        }

        .settings-modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .settings-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .settings-modal-close {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: var(--radius);
            border: none;
            background: var(--gray-100);
            color: var(--gray-600);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .settings-modal-close:hover {
            background: var(--gray-200);
            color: var(--primary);
        }

        .settings-modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: 60vh;
        }

        .settings-modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .privacy-settings {
            display: grid;
            gap: 1rem;
        }

        .privacy-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: var(--gray-50);
            border-radius: var(--radius);
            border: 1px solid var(--gray-200);
        }

        .privacy-item-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .privacy-item-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .privacy-item-description {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        /* ===== NOTIFICATIONS ===== */
        .notification {
            position: fixed;
            top: 1.25rem;
            right: 1.25rem;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            background: var(--primary);
            color: var(--light);
            font-weight: 500;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            animation: slideInRight 0.3s ease;
            max-width: 24rem;
            word-wrap: break-word;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== UTILITY CLASSES ===== */
        .hidden { display: none; }
        .text-center { text-align: center; }
        .mt-4 { margin-top: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .ml-2 { margin-left: 0.5rem; }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 640px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
            
            .filters-content {
                max-height: 90vh;
            }
            
            .price-inputs {
                grid-template-columns: 1fr;
            }
            
            .profile-section {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="loader-container">
            <div class="loader-square"></div>
            <div class="loader-fill"></div>
            <div class="loader-progress" id="loaderProgress">0%</div>
        </div>
        <div class="loader-text" id="loaderText">–ó–∞–≥—Ä—É–∑–∫–∞ SNEAKER VAULT...</div>
    </div>

    <!-- App Container -->
    <div id="app" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <a href="#" class="logo" onclick="showPage('catalog'); return false;">
                    <div class="logo-icon">
                        <i class="fas fa-vault"></i>
                    </div>
                    <div class="logo-text">
                        <div class="logo-title">SNEAKER VAULT</div>
                        <div class="logo-subtitle">ORIGINAL SNEAKERS</div>
                    </div>
                </a>
                
                <div class="header-actions">
                    <button class="icon-btn" onclick="showPage('favorites')" id="favoritesBtn">
                        <i class="fas fa-heart"></i>
                        <span class="badge" id="favBadge"></span>
                    </button>
                    <button class="icon-btn" onclick="showPage('cart')" id="cartBtn">
                        <i class="fas fa-shopping-bag"></i>
                        <span class="badge" id="cartBadge"></span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Filters Modal -->
        <div class="filters-modal" id="filtersModal">
            <div class="filters-content">
                <div class="filters-header">
                    <div class="filters-title">–§–∏–ª—å—Ç—Ä—ã</div>
                    <button class="filters-close" onclick="closeFilters()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="filters-body" id="filtersBody">
                    <!-- –§–∏–ª—å—Ç—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                </div>
                <div class="filters-footer">
                    <button class="btn btn-secondary btn-block" onclick="clearFilters()">
                        <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                    </button>
                    <button class="btn btn-primary btn-block" onclick="applyFilters()">
                        <i class="fas fa-check"></i> –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="settings-modal" id="settingsModal">
            <div class="settings-modal-content">
                <div class="settings-modal-header">
                    <h2 class="settings-modal-title" id="settingsModalTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h2>
                    <button class="settings-modal-close" onclick="closeSettingsModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="settings-modal-body" id="settingsModalBody">
                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                </div>
                <div class="settings-modal-footer">
                    <button class="btn btn-secondary" onclick="closeSettingsModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-primary" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- Privacy Modal -->
        <div class="settings-modal" id="privacyModal">
            <div class="settings-modal-content">
                <div class="settings-modal-header">
                    <h2 class="settings-modal-title" id="privacyModalTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏</h2>
                    <button class="settings-modal-close" onclick="closePrivacyModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="settings-modal-body" id="privacyModalBody">
                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                </div>
                <div class="settings-modal-footer">
                    <button class="btn btn-secondary" onclick="closePrivacyModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-primary" onclick="savePrivacySettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="content" id="content">
            <!-- Content will be loaded here -->
        </main>

        <!-- Navigation -->
        <nav class="nav">
            <div class="nav-grid">
                <button class="nav-btn active" onclick="showPage('catalog')" data-page="catalog">
                    <i class="fas fa-store"></i>
                    <span>–ö–∞—Ç–∞–ª–æ–≥</span>
                </button>
                <button class="nav-btn" onclick="showPage('favorites')" data-page="favorites">
                    <i class="fas fa-heart"></i>
                    <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                </button>
                <button class="nav-btn" onclick="showPage('cart')" data-page="cart">
                    <i class="fas fa-shopping-bag"></i>
                    <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
                </button>
                <button class="nav-btn" onclick="showPage('profile')" data-page="profile">
                    <i class="fas fa-user"></i>
                    <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                </button>
            </div>
        </nav>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        const firebaseConfig = {
            apiKey: "AIzaSyC93OKuu2nYzMU80ZtZcqTMh8Js5866Hwc",
            authDomain: "sneakervault-80a48.firebaseapp.com",
            projectId: "sneakervault-80a48",
            storageBucket: "sneakervault-80a48.firebasestorage.app",
            messagingSenderId: "114772799409",
            appId: "1:114772799409:web:95b4c8c0e6461cd0e41790"
        };

        const TELEGRAM_BOT_TOKEN = "8521590362:AAGBtRNHQGfBB147h1dKsn_U-9qXbOlEnvA";
        
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let db = null;
        let storage = null;
        let currentUser = null;
        let currentPage = 'catalog';
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let products = [];
        let filters = {};
        let activeFilters = {};
        let filterConfig = null;
        let tg = null;
        let isInitialized = false;
        let minPrice = 0;
        let maxPrice = 100000;
        let userOrders = [];
        let userSettings = {
            notifications: {
                newProducts: true,
                promotions: true,
                orderUpdates: true,
                stockAlerts: true
            },
            privacy: {
                showProfile: true,
                showOrders: true,
                showActivity: false,
                shareData: false
            },
            preferences: {
                currency: 'RUB',
                language: 'ru',
                theme: 'light'
            }
        };

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        async function initApp() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            try {
                updateLoader('–ó–∞–≥—Ä—É–∑–∫–∞ Firebase...', 10);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                db = firebase.firestore();
                storage = firebase.storage();
                console.log('‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω');
                
                updateLoader('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram...', 30);
                if (window.Telegram && window.Telegram.WebApp) {
                    tg = window.Telegram.WebApp;
                    tg.expand();
                    tg.ready();
                    console.log('‚úÖ Telegram WebApp –ø–æ–¥–∫–ª—é—á–µ–Ω');
                }
                
                updateLoader('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤...', 50);
                await loadFilterConfig();
                
                updateLoader('–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...', 70);
                await loadProducts(); // –ò–°–ü–†–ê–í–õ–ï–ù–û: –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–∑ Firebase
                
                updateLoader('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...', 90);
                await setupUser();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (currentUser) {
                    await loadUserOrders();
                }
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                loadUserSettings();
                
                setTimeout(() => {
                    document.getElementById('loader').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loader').style.display = 'none';
                        document.getElementById('app').classList.remove('hidden');
                        showPage('catalog');
                        updateBadges();
                        isInitialized = true;
                        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
                        showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SNEAKER VAULT!');
                    }, 300);
                }, 500);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                document.getElementById('loader').innerHTML = `
                    <div style="text-align: center; color: white; padding: 2rem;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h2 style="margin-bottom: 0.75rem; font-weight: 600;">–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
                        <p style="margin-bottom: 1.5rem; opacity: 0.8;">${error.message}</p>
                        <button onclick="location.reload()" style="
                            padding: 0.75rem 1.5rem;
                            background: white;
                            color: black;
                            border: none;
                            border-radius: var(--radius);
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É
                        </button>
                    </div>
                `;
            }
        }

        function updateLoader(text, progress) {
            const loaderText = document.getElementById('loaderText');
            const loaderProgress = document.getElementById('loaderProgress');
            if (loaderText) loaderText.textContent = text;
            if (loaderProgress) loaderProgress.textContent = progress + '%';
        }

        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –§–ò–õ–¨–¢–†–û–í ====================
        async function loadFilterConfig() {
            try {
                const configDoc = await db.collection('config').doc('filters').get();
                
                if (configDoc.exists) {
                    filterConfig = configDoc.data();
                    console.log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ Firebase');
                } else {
                    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    filterConfig = {
                        categories: [
                            { id: 'air-jordan', name: 'Air Jordan', color: '#000000' },
                            { id: 'nike-dunk', name: 'Nike Dunk', color: '#111111' },
                            { id: 'air-force', name: 'Air Force', color: '#222222' },
                            { id: 'air-max', name: 'Air Max', color: '#333333' },
                            { id: 'blazer', name: 'Blazer', color: '#444444' },
                            { id: 'other', name: '–î—Ä—É–≥–æ–µ', color: '#555555' }
                        ],
                        genders: [
                            { id: 'men', name: '–ú—É–∂—Å–∫–∏–µ', icon: 'mars' },
                            { id: 'women', name: '–ñ–µ–Ω—Å–∫–∏–µ', icon: 'venus' },
                            { id: 'unisex', name: '–£–Ω–∏—Å–µ–∫—Å', icon: 'transgender' }
                        ],
                        sizes: ['36 (23 —Å–º)', '37 (23.5 —Å–º)', '38 (24 —Å–º)', '39 (24.5 —Å–º)', '40 (25 —Å–º)', '41 (25.5 —Å–º)', '42 (26 —Å–º)', '43 (26.5 —Å–º)', '44 (27 —Å–º)', '45 (27.5 —Å–º)', '46 (28 —Å–º)', '47 (28.5 —Å–º)'],
                        priceRange: {
                            min: 0,
                            max: 100000,
                            step: 1000
                        },
                        sortOptions: [
                            { id: 'newest', name: '–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ' },
                            { id: 'price_asc', name: '–ü–æ —Ü–µ–Ω–µ (–¥–µ—à–µ–≤—ã–µ)' },
                            { id: 'price_desc', name: '–ü–æ —Ü–µ–Ω–µ (–¥–æ—Ä–æ–≥–∏–µ)' },
                            { id: 'popular', name: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ' }
                        ]
                    };
                    
                    await db.collection('config').doc('filters').set(filterConfig);
                    console.log('‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
                }
                
                minPrice = filterConfig.priceRange.min;
                maxPrice = filterConfig.priceRange.max;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', error);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                filterConfig = {
                    categories: [
                        { id: 'air-jordan', name: 'Air Jordan', color: '#000000' },
                        { id: 'nike-dunk', name: 'Nike Dunk', color: '#111111' },
                        { id: 'air-force', name: 'Air Force', color: '#222222' },
                        { id: 'air-max', name: 'Air Max', color: '#333333' },
                        { id: 'blazer', name: 'Blazer', color: '#444444' },
                        { id: 'other', name: '–î—Ä—É–≥–æ–µ', color: '#555555' }
                    ],
                    genders: [
                        { id: 'men', name: '–ú—É–∂—Å–∫–∏–µ', icon: 'mars' },
                        { id: 'women', name: '–ñ–µ–Ω—Å–∫–∏–µ', icon: 'venus' },
                        { id: 'unisex', name: '–£–Ω–∏—Å–µ–∫—Å', icon: 'transgender' }
                    ],
                    sizes: ['36 (23 —Å–º)', '37 (23.5 —Å–º)', '38 (24 —Å–º)', '39 (24.5 —Å–º)', '40 (25 —Å–º)', '41 (25.5 —Å–º)', '42 (26 —Å–º)', '43 (26.5 —Å–º)', '44 (27 —Å–º)', '45 (27.5 —Å–º)', '46 (28 —Å–º)', '47 (28.5 —Å–º)'],
                    priceRange: {
                        min: 0,
                        max: 100000,
                        step: 1000
                    },
                    sortOptions: [
                        { id: 'newest', name: '–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ' },
                        { id: 'price_asc', name: '–ü–æ —Ü–µ–Ω–µ (–¥–µ—à–µ–≤—ã–µ)' },
                        { id: 'price_desc', name: '–ü–æ —Ü–µ–Ω–µ (–¥–æ—Ä–æ–≥–∏–µ)' },
                        { id: 'popular', name: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ' }
                    ]
                };
            }
        }
        
        function renderFilters() {
            if (!filterConfig) return '';
            
            return `
                <div class="search-filter-container">
                    <input type="text" 
                           class="search-filter-input" 
                           id="filterSearch" 
                           placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
                           value="${activeFilters.search || ''}"
                           oninput="updateSearchFilter(this.value)">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">–ö–æ–ª–ª–µ–∫—Ü–∏—è</label>
                    <div class="filter-options">
                        ${filterConfig.categories.map(category => `
                            <button class="filter-option ${activeFilters.category === category.id ? 'active' : ''}"
                                    onclick="toggleFilter('category', '${category.id}')"
                                    style="${activeFilters.category === category.id ? `background: ${category.color}; border-color: ${category.color}` : ''}">
                                ${category.name}
                            </button>
                        `).join('')}
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">–ü–æ–ª</label>
                    <div class="filter-options">
                        ${filterConfig.genders.map(gender => `
                            <button class="filter-option ${activeFilters.gender === gender.id ? 'active' : ''}"
                                    onclick="toggleFilter('gender', '${gender.id}')">
                                <i class="fas fa-${gender.icon}"></i> ${gender.name}
                            </button>
                        `).join('')}
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">–†–∞–∑–º–µ—Ä (RU/—Å–º)</label>
                    <div class="filter-options">
                        ${filterConfig.sizes.map(size => `
                            <button class="filter-option ${activeFilters.size === size ? 'active' : ''}"
                                    onclick="toggleFilter('size', '${size}')">
                                ${size}
                            </button>
                        `).join('')}
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">–¶–µ–Ω–∞, ‚ÇΩ</label>
                    <div class="price-range-container">
                        <div class="range-slider">
                            <div class="range-track"></div>
                            <div class="range-selected" id="rangeSelected"></div>
                            <input type="range" class="range-input" id="minPriceRange"
                                   min="${minPrice}" max="${maxPrice}" step="1000"
                                   value="${activeFilters.minPrice || minPrice}"
                                   oninput="updateMinPriceSlider(this.value)">
                            <input type="range" class="range-input" id="maxPriceRange"
                                   min="${minPrice}" max="${maxPrice}" step="1000"
                                   value="${activeFilters.maxPrice || maxPrice}"
                                   oninput="updateMaxPriceSlider(this.value)">
                        </div>
                        <div class="price-inputs">
                            <div>
                                <input type="number" 
                                       class="price-input" 
                                       id="minPriceInput"
                                       placeholder="–û—Ç" 
                                       value="${activeFilters.minPrice || minPrice}"
                                       oninput="updateMinPriceInput(this.value)">
                            </div>
                            <div>
                                <input type="number" 
                                       class="price-input" 
                                       id="maxPriceInput"
                                       placeholder="–î–æ" 
                                       value="${activeFilters.maxPrice || maxPrice}"
                                       oninput="updateMaxPriceInput(this.value)">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                    <div class="filter-options">
                        ${filterConfig.sortOptions.map(option => `
                            <button class="filter-option ${activeFilters.sort === option.id ? 'active' : ''}"
                                    onclick="toggleFilter('sort', '${option.id}')">
                                ${option.name}
                            </button>
                        `).join('')}
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">–ù–∞–ª–∏—á–∏–µ</label>
                    <div class="filter-options">
                        <button class="filter-option ${activeFilters.inStock ? 'active' : ''}"
                                onclick="toggleFilter('inStock', true)">
                            <i class="fas fa-check"></i> –í –Ω–∞–ª–∏—á–∏–∏
                        </button>
                        <button class="filter-option ${activeFilters.newArrival ? 'active' : ''}"
                                onclick="toggleFilter('newArrival', true)">
                            <i class="fas fa-star"></i> –ù–æ–≤–∏–Ω–∫–∏
                        </button>
                    </div>
                </div>
            `;
        }
        
        function updateMinPriceSlider(value) {
            const maxPriceSlider = document.getElementById('maxPriceRange');
            const maxPriceValue = parseInt(maxPriceSlider.value);
            
            if (parseInt(value) > maxPriceValue) {
                value = maxPriceValue;
                document.getElementById('minPriceRange').value = value;
            }
            
            document.getElementById('minPriceInput').value = value;
            updatePriceRange();
            activeFilters.minPrice = parseInt(value);
        }
        
        function updateMaxPriceSlider(value) {
            const minPriceSlider = document.getElementById('minPriceRange');
            const minPriceValue = parseInt(minPriceSlider.value);
            
            if (parseInt(value) < minPriceValue) {
                value = minPriceValue;
                document.getElementById('maxPriceRange').value = value;
            }
            
            document.getElementById('maxPriceInput').value = value;
            updatePriceRange();
            activeFilters.maxPrice = parseInt(value);
        }
        
        function updateMinPriceInput(value) {
            const minPriceSlider = document.getElementById('minPriceRange');
            const maxPriceValue = parseInt(document.getElementById('maxPriceInput').value);
            
            let intValue = parseInt(value) || minPrice;
            if (intValue < minPrice) intValue = minPrice;
            if (intValue > maxPriceValue) intValue = maxPriceValue;
            
            minPriceSlider.value = intValue;
            document.getElementById('minPriceInput').value = intValue;
            updatePriceRange();
            activeFilters.minPrice = intValue;
        }
        
        function updateMaxPriceInput(value) {
            const maxPriceSlider = document.getElementById('maxPriceRange');
            const minPriceValue = parseInt(document.getElementById('minPriceInput').value);
            
            let intValue = parseInt(value) || maxPrice;
            if (intValue > maxPrice) intValue = maxPrice;
            if (intValue < minPriceValue) intValue = minPriceValue;
            
            maxPriceSlider.value = intValue;
            document.getElementById('maxPriceInput').value = intValue;
            updatePriceRange();
            activeFilters.maxPrice = intValue;
        }
        
        function updatePriceRange() {
            const minPriceSlider = document.getElementById('minPriceRange');
            const maxPriceSlider = document.getElementById('maxPriceRange');
            const rangeSelected = document.getElementById('rangeSelected');
            
            if (!minPriceSlider || !maxPriceSlider || !rangeSelected) return;
            
            const minValue = parseInt(minPriceSlider.value);
            const maxValue = parseInt(maxPriceSlider.value);
            const minPercent = ((minValue - minPrice) / (maxPrice - minPrice)) * 100;
            const maxPercent = ((maxValue - minPrice) / (maxPrice - minPrice)) * 100;
            
            rangeSelected.style.left = minPercent + '%';
            rangeSelected.style.width = (maxPercent - minPercent) + '%';
        }
        
        function toggleFilter(type, value) {
            if (activeFilters[type] === value) {
                delete activeFilters[type];
            } else {
                activeFilters[type] = value;
            }
            
            const filterOptions = document.querySelectorAll(`[onclick*="${type}"]`);
            filterOptions.forEach(option => {
                const filterValue = option.getAttribute('onclick').match(/'([^']+)'/)[1];
                option.classList.toggle('active', activeFilters[type] === filterValue);
            });
        }
        
        function updateSearchFilter(value) {
            if (value.trim()) {
                activeFilters.search = value.trim();
            } else {
                delete activeFilters.search;
            }
        }
        
        function openFilters() {
            document.getElementById('filtersModal').classList.add('active');
            document.getElementById('filtersBody').innerHTML = renderFilters();
            updatePriceRange();
        }
        
        function closeFilters() {
            document.getElementById('filtersModal').classList.remove('active');
        }
        
        function clearFilters() {
            activeFilters = {};
            document.getElementById('filtersBody').innerHTML = renderFilters();
            applyFilters();
        }
        
        function applyFilters() {
            closeFilters();
            showPage('catalog');
        }
        
        function renderActiveFilters() {
            const activeFiltersDiv = document.getElementById('activeFilters');
            if (!activeFiltersDiv) return;
            
            let html = '';
            
            if (activeFilters.search) {
                html += `<div class="active-filter">
                    <span>–ü–æ–∏—Å–∫: ${activeFilters.search}</span>
                    <button onclick="removeFilter('search')">√ó</button>
                </div>`;
            }
            
            if (activeFilters.category) {
                const category = filterConfig.categories.find(c => c.id === activeFilters.category);
                html += `<div class="active-filter">
                    <span>–ö–æ–ª–ª–µ–∫—Ü–∏—è: ${category?.name || activeFilters.category}</span>
                    <button onclick="removeFilter('category')">√ó</button>
                </div>`;
            }
            
            if (activeFilters.gender) {
                const gender = filterConfig.genders.find(g => g.id === activeFilters.gender);
                html += `<div class="active-filter">
                    <span>–ü–æ–ª: ${gender?.name || activeFilters.gender}</span>
                    <button onclick="removeFilter('gender')">√ó</button>
                </div>`;
            }
            
            if (activeFilters.size) {
                html += `<div class="active-filter">
                    <span>–†–∞–∑–º–µ—Ä: ${activeFilters.size}</span>
                    <button onclick="removeFilter('size')">√ó</button>
                </div>`;
            }
            
            if (activeFilters.minPrice || activeFilters.maxPrice) {
                const min = activeFilters.minPrice || minPrice;
                const max = activeFilters.maxPrice || maxPrice;
                html += `<div class="active-filter">
                    <span>–¶–µ–Ω–∞: ${formatPrice(min)} - ${formatPrice(max)}</span>
                    <button onclick="removePriceFilter()">√ó</button>
                </div>`;
            }
            
            if (activeFilters.inStock) {
                html += `<div class="active-filter">
                    <span>–í –Ω–∞–ª–∏—á–∏–∏</span>
                    <button onclick="removeFilter('inStock')">√ó</button>
                </div>`;
            }
            
            if (activeFilters.newArrival) {
                html += `<div class="active-filter">
                    <span>–ù–æ–≤–∏–Ω–∫–∏</span>
                    <button onclick="removeFilter('newArrival')">√ó</button>
                </div>`;
            }
            
            if (activeFilters.sort) {
                const sortOption = filterConfig.sortOptions.find(s => s.id === activeFilters.sort);
                html += `<div class="active-filter">
                    <span>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: ${sortOption?.name || activeFilters.sort}</span>
                    <button onclick="removeFilter('sort')">√ó</button>
                </div>`;
            }
            
            if (Object.keys(activeFilters).length > 0) {
                html += `<button class="clear-filters" onclick="clearFilters()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>`;
            }
            
            activeFiltersDiv.innerHTML = html;
        }
        
        function removeFilter(filterKey) {
            delete activeFilters[filterKey];
            applyFilters();
        }
        
        function removePriceFilter() {
            delete activeFilters.minPrice;
            delete activeFilters.maxPrice;
            applyFilters();
        }
        
        function filterProducts(products) {
            return products.filter(product => {
                if (activeFilters.search) {
                    const searchTerm = activeFilters.search.toLowerCase();
                    if (!product.name.toLowerCase().includes(searchTerm) &&
                        !product.description.toLowerCase().includes(searchTerm) &&
                        !product.sku.toLowerCase().includes(searchTerm)) {
                        return false;
                    }
                }
                
                if (activeFilters.category && product.category !== activeFilters.category) {
                    return false;
                }
                
                if (activeFilters.gender && product.gender !== activeFilters.gender) {
                    return false;
                }
                
                if (activeFilters.size && (!product.sizes || !product.sizes[activeFilters.size] || product.sizes[activeFilters.size] <= 0)) {
                    return false;
                }
                
                if (activeFilters.minPrice && product.discountPrice ? product.discountPrice < activeFilters.minPrice : product.price < activeFilters.minPrice) {
                    return false;
                }
                
                if (activeFilters.maxPrice && product.discountPrice ? product.discountPrice > activeFilters.maxPrice : product.price > activeFilters.maxPrice) {
                    return false;
                }
                
                if (activeFilters.inStock) {
                    const totalStock = product.sizes ? Object.values(product.sizes).reduce((sum, stock) => sum + stock, 0) : 0;
                    if (totalStock <= 0) return false;
                }
                
                if (activeFilters.newArrival && !product.isNew) {
                    return false;
                }
                
                return true;
            }).sort((a, b) => {
                if (activeFilters.sort === 'price_asc') {
                    return (a.discountPrice || a.price) - (b.discountPrice || b.price);
                } else if (activeFilters.sort === 'price_desc') {
                    return (b.discountPrice || b.price) - (a.discountPrice || a.price);
                } else if (activeFilters.sort === 'newest') {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                } else if (activeFilters.sort === 'popular') {
                    return (b.purchases || 0) - (a.purchases || 0);
                }
                return 0;
            });
        }

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò ====================
        async function setupUser() {
            try {
                let userData = null;
                
                if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const tgUser = tg.initDataUnsafe.user;
                    userData = {
                        id: tgUser.id.toString(),
                        firstName: tgUser.first_name || '–ì–æ—Å—Ç—å',
                        lastName: tgUser.last_name || '',
                        username: tgUser.username || '',
                        isAdmin: false
                    };
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @Sekynds
                    if (tgUser.id === 1079922982) {
                        userData.isAdmin = true;
                        console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @Sekynds - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä');
                    }
                } else {
                    userData = {
                        id: 'guest_' + Math.random().toString(36).substr(2, 9),
                        firstName: '–ì–æ—Å—Ç—å',
                        isAdmin: false
                    };
                }
                
                currentUser = userData;
                await saveUserToFirebase(userData);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                currentUser = {
                    id: 'error_' + Date.now(),
                    firstName: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    isAdmin: false
                };
            }
        }
        
        async function saveUserToFirebase(userData) {
            if (!db || !userData) return;
            
            try {
                const userRef = db.collection('users').doc(userData.id);
                const userToSave = {
                    ...userData,
                    lastLogin: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                const userDoc = await userRef.get();
                if (!userDoc.exists) {
                    userToSave.createdAt = new Date().toISOString();
                }
                
                await userRef.set(userToSave, { merge: true });
                console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Firebase');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            }
        }
        
        async function loadUserOrders() {
            if (!currentUser || !db) return;
            
            try {
                const ordersSnapshot = await db.collection('orders')
                    .where('userId', '==', currentUser.id)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                userOrders = [];
                ordersSnapshot.forEach(doc => {
                    const data = doc.data();
                    userOrders.push({
                        id: doc.id,
                        ...data
                    });
                });
                
                localStorage.setItem('userOrders', JSON.stringify(userOrders));
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${userOrders.length} –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è`);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            }
        }
        
        function loadUserSettings() {
            const savedSettings = localStorage.getItem('userSettings');
            if (savedSettings) {
                userSettings = JSON.parse(savedSettings);
            }
        }
        
        function saveUserSettings() {
            localStorage.setItem('userSettings', JSON.stringify(userSettings));
        }
        
        function openSettingsModal(type) {
            const modal = document.getElementById('settingsModal');
            const title = document.getElementById('settingsModalTitle');
            const body = document.getElementById('settingsModalBody');
            
            if (type === 'notifications') {
                title.textContent = '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π';
                body.innerHTML = `
                    <div class="notification-settings">
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">–ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã</div>
                                <div class="notification-item-description">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è—Ö</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" ${userSettings.notifications.newProducts ? 'checked' : ''} 
                                       onchange="userSettings.notifications.newProducts = this.checked">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">–ê–∫—Ü–∏–∏ –∏ —Å–∫–∏–¥–∫–∏</div>
                                <div class="notification-item-description">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" ${userSettings.notifications.promotions ? 'checked' : ''}
                                       onchange="userSettings.notifications.promotions = this.checked">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤</div>
                                <div class="notification-item-description">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" ${userSettings.notifications.orderUpdates ? 'checked' : ''}
                                       onchange="userSettings.notifications.orderUpdates = this.checked">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">–ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫</div>
                                <div class="notification-item-description">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏—Ö—Å—è —Ç–æ–≤–∞—Ä–∞—Ö</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" ${userSettings.notifications.stockAlerts ? 'checked' : ''}
                                       onchange="userSettings.notifications.stockAlerts = this.checked">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                `;
            }
            
            modal.classList.add('active');
        }
        
        function openPrivacyModal() {
            const modal = document.getElementById('privacyModal');
            const title = document.getElementById('privacyModalTitle');
            const body = document.getElementById('privacyModalBody');
            
            title.textContent = '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏';
            body.innerHTML = `
                <div class="privacy-settings">
                    <div class="privacy-item">
                        <div class="privacy-item-info">
                            <div class="privacy-item-title">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</div>
                            <div class="privacy-item-description">–†–∞–∑—Ä–µ—à–∏—Ç—å –¥—Ä—É–≥–∏–º –≤–∏–¥–µ—Ç—å –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" ${userSettings.privacy.showProfile ? 'checked' : ''}
                                   onchange="userSettings.privacy.showProfile = this.checked">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="privacy-item">
                        <div class="privacy-item-info">
                            <div class="privacy-item-title">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã</div>
                            <div class="privacy-item-description">–†–∞–∑—Ä–µ—à–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" ${userSettings.privacy.showOrders ? 'checked' : ''}
                                   onchange="userSettings.privacy.showOrders = this.checked">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="privacy-item">
                        <div class="privacy-item-info">
                            <div class="privacy-item-title">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                            <div class="privacy-item-description">–†–∞–∑—Ä–µ—à–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –≤–∞—à–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" ${userSettings.privacy.showActivity ? 'checked' : ''}
                                   onchange="userSettings.privacy.showActivity = this.checked">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="privacy-item">
                        <div class="privacy-item-info">
                            <div class="privacy-item-title">–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö</div>
                            <div class="privacy-item-description">–†–∞–∑—Ä–µ—à–∏—Ç—å —Å–±–æ—Ä –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" ${userSettings.privacy.shareData ? 'checked' : ''}
                                   onchange="userSettings.privacy.shareData = this.checked">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: var(--gray-50); border-radius: var(--radius);">
                        <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--gray-700); margin-bottom: 0.5rem;">–û –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏</h3>
                        <p style="font-size: 0.75rem; color: var(--gray-600); line-height: 1.5;">
                            –ú—ã —Å–µ—Ä—å–µ–∑–Ω–æ –æ—Ç–Ω–æ—Å–∏–º—Å—è –∫ –∑–∞—â–∏—Ç–µ –≤–∞—à–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥ –º–∞–≥–∞–∑–∏–Ω–∞.
                        </p>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
        }
        
        function closePrivacyModal() {
            document.getElementById('privacyModal').classList.remove('active');
        }
        
        function saveSettings() {
            saveUserSettings();
            closeSettingsModal();
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }
        
        function savePrivacySettings() {
            saveUserSettings();
            closePrivacyModal();
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        // ==================== –¢–û–í–ê–†–´ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î) ====================
        async function loadProducts() {
            try {
                console.log('üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Firebase...');
                
                // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ isActive
                // —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã, –≤–∫–ª—é—á–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
                const snapshot = await db.collection('products')
                    .orderBy('createdAt', 'desc')
                    .limit(100)
                    .get();
                
                products = [];
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã –±–µ–∑ ID
                    if (!doc.id) return;
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    let mainImageUrl = '';
                    if (data.images && data.images.length > 0) {
                        mainImageUrl = data.images[0];
                    } else if (data.image) {
                        mainImageUrl = data.image;
                    } else {
                        mainImageUrl = 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&h=300&fit=crop';
                    }
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º sizes –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                    let sizesData = data.sizes || {};
                    if (Array.isArray(sizesData)) {
                        const sizesObj = {};
                        sizesData.forEach(size => {
                            sizesObj[size] = 1;
                        });
                        sizesData = sizesObj;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ sizes —ç—Ç–æ –æ–±—ä–µ–∫—Ç
                    if (typeof sizesData !== 'object' || sizesData === null) {
                        sizesData = {};
                    }
                    
                    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
                    if (!data.name || !data.category) {
                        console.warn('‚ö†Ô∏è –¢–æ–≤–∞—Ä –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', doc.id);
                        return;
                    }
                    
                    products.push({
                        id: doc.id,
                        name: data.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
                        category: data.category || 'other',
                        gender: data.gender || 'unisex',
                        sizes: sizesData,
                        price: parseFloat(data.price) || 0,
                        discountPrice: data.discountPrice ? parseFloat(data.discountPrice) : null,
                        badges: data.badges || [],
                        stock: data.stock || 0,
                        isNew: data.isNew || false,
                        sku: data.sku || '',
                        description: data.description || '',
                        images: data.images || [],
                        image: mainImageUrl,
                        createdAt: data.createdAt || new Date().toISOString(),
                        purchases: data.purchases || 0,
                        views: data.views || 0,
                        brand: data.brand || 'Nike',
                        isActive: data.isActive !== false // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–∫—Ç–∏–≤–µ–Ω
                    });
                });
                
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${products.length} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Firebase`);
                
                // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–ï —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã! –†–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å Firebase
                if (products.length === 0) {
                    console.log('‚ÑπÔ∏è –í Firebase –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.');
                    showNotification('–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.', 'info');
                }
                
                // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤:', {
                    –≤—Å–µ–≥–æ: products.length,
                    –∞–∫—Ç–∏–≤–Ω—ã—Ö: products.filter(p => p.isActive !== false).length,
                    –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö: products.filter(p => p.isActive === false).length,
                    –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: [...new Set(products.map(p => p.category))]
                });
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase.', 'error');
                products = [];
            }
        }
        
        function renderProductCard(product) {
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞
            if (product.isActive === false) {
                return ''; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            }
            
            const isFav = favorites.includes(product.id);
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫
            const totalStock = product.sizes ? Object.values(product.sizes).reduce((sum, stock) => sum + stock, 0) : 0;
            const isLowStock = totalStock < 3 && totalStock > 0;
            const isOutOfStock = totalStock === 0;
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –±–µ–π–¥–∂–∏
            let badgesHtml = '';
            if (product.badges && product.badges.length > 0) {
                product.badges.forEach(badge => {
                    switch(badge) {
                        case 'new':
                            badgesHtml += '<span class="product-badge badge-new">NEW</span>';
                            break;
                        case 'exclusive':
                            badgesHtml += '<span class="product-badge badge-exclusive">–≠–ö–°–ö–õ–Æ–ó–ò–í</span>';
                            break;
                        case 'discount':
                            badgesHtml += '<span class="product-badge badge-discount">-'+calculateDiscountPercent(product.price, product.discountPrice)+'%</span>';
                            break;
                    }
                });
            }
            
            // –ë–µ–π–¥–∂ –Ω–∞–ª–∏—á–∏—è
            let stockBadge = '';
            if (isOutOfStock) {
                stockBadge = '<span class="badge-stock out">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>';
            } else if (isLowStock) {
                stockBadge = `<span class="badge-stock low">–û—Å—Ç–∞–ª–æ—Å—å ${totalStock}</span>`;
            }
            
            let genderIcon = 'transgender';
            if (product.gender === 'men') genderIcon = 'mars';
            if (product.gender === 'women') genderIcon = 'venus';
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —Ä–∞–∑–º–µ—Ä—ã
            let sizesHtml = '';
            if (product.sizes && Object.keys(product.sizes).length > 0) {
                sizesHtml = '<div class="product-sizes">';
                Object.keys(product.sizes).forEach(size => {
                    const stock = product.sizes[size];
                    if (stock > 0) {
                        sizesHtml += `<span class="size-tag">${size}</span>`;
                    }
                });
                sizesHtml += '</div>';
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ü–µ–Ω—ã
            let priceHtml = '';
            if (product.discountPrice && product.discountPrice < product.price) {
                const discountPercent = calculateDiscountPercent(product.price, product.discountPrice);
                priceHtml = `
                    <div class="product-price">
                        <div class="original-price">${formatPrice(product.price)}</div>
                        <div class="current-price">
                            ${formatPrice(product.discountPrice)}
                            <span class="discount-percent">-${discountPercent}%</span>
                        </div>
                    </div>
                `;
            } else {
                priceHtml = `
                    <div class="product-price">
                        <div class="current-price">${formatPrice(product.price)}</div>
                    </div>
                `;
            }
            
            return `
                <div class="product-card">
                    <div class="product-image">
                        <img src="${product.image}" 
                             alt="${product.name}"
                             onerror="this.src='https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&h=300&fit=crop'">
                        
                        <div class="product-badges">
                            ${badgesHtml}
                            ${stockBadge}
                        </div>
                        
                        <button class="favorite-btn ${isFav ? 'active' : ''}" onclick="toggleFavorite('${product.id}')">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    
                    <div class="product-info">
                        <div class="product-category">
                            <i class="fas fa-${genderIcon}"></i> 
                            ${getCategoryName(product.category)}
                        </div>
                        <div class="product-name">${product.name}</div>
                        
                        <div class="product-price-container">
                            ${priceHtml}
                            <button class="add-to-cart" 
                                    onclick="addToCart('${product.id}')"
                                    ${isOutOfStock ? 'disabled' : ''}
                                    title="${isOutOfStock ? '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏' : '–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É'}">
                                <i class="fas fa-${isOutOfStock ? 'times' : 'plus'}"></i>
                            </button>
                        </div>
                        
                        ${sizesHtml}
                    </div>
                </div>
            `;
        }
        
        function calculateDiscountPercent(originalPrice, discountPrice) {
            if (!originalPrice || !discountPrice) return 0;
            return Math.round(((originalPrice - discountPrice) / originalPrice) * 100);
        }
        
        function getCategoryName(categoryId) {
            if (!filterConfig) return categoryId;
            const category = filterConfig.categories.find(c => c.id === categoryId);
            return category ? category.name : categoryId;
        }

        // ==================== –ö–û–†–ó–ò–ù–ê ====================
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                showNotification('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫
            const totalStock = product.sizes ? Object.values(product.sizes).reduce((sum, stock) => sum + stock, 0) : 0;
            if (totalStock <= 0) {
                showNotification('–¢–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è', 'error');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–∞ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–º–µ—Ä–æ–≤
            if (product.sizes && Object.keys(product.sizes).length > 1) {
                selectSizeForCart(product);
                return;
            }
            
            // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑–º–µ—Ä, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ
            const size = product.sizes ? Object.keys(product.sizes)[0] : '–û–¥–∏–Ω —Ä–∞–∑–º–µ—Ä';
            addToCartWithSize(product, size);
        }
        
        function selectSizeForCart(product) {
            const sizes = product.sizes ? Object.keys(product.sizes) : [];
            let sizeOptions = '';
            
            sizes.forEach(size => {
                const stock = product.sizes[size];
                if (stock > 0) {
                    sizeOptions += `
                        <div class="size-option" onclick="addToCartWithSize('${product.id}', '${size}')"
                             style="padding: 0.75rem; border: 1px solid var(--gray-200); border-radius: var(--radius); cursor: pointer; margin-bottom: 0.5rem; transition: var(--transition);"
                             onmouseover="this.style.backgroundColor='var(--gray-50)'"
                             onmouseout="this.style.backgroundColor='transparent'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="font-weight: 600;">${size}</div>
                                <div style="font-size: 0.875rem; color: var(--success);">
                                    ${stock} —à—Ç.
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 1rem;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--light); border-radius: var(--radius-lg); padding: 1.5rem; width: 100%; max-width: 400px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 700; color: var(--primary);">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="width: 2rem; height: 2rem; border-radius: 50%; border: none; background: var(--gray-100); color: var(--gray-600); cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        ${sizeOptions || '<p style="color: var(--error); text-align: center;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤</p>'}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function addToCartWithSize(productId, size) {
            // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–ª–∏ ID —Ç–æ–≤–∞—Ä–∞ –≤–º–µ—Å—Ç–æ –æ–±—ä–µ–∫—Ç–∞
            const product = typeof productId === 'string' ? products.find(p => p.id === productId) : productId;
            if (!product) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
            if (product.sizes && product.sizes[size] <= 0) {
                showNotification('–í—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏', 'error');
                return;
            }
            
            const existingItem = cart.find(item => item.id === product.id && item.size === size);
            
            if (existingItem) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ–º –ª–∏ –æ—Å—Ç–∞—Ç–æ–∫
                if (existingItem.quantity >= product.sizes[size]) {
                    showNotification('–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —ç—Ç–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞', 'error');
                    return;
                }
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.discountPrice || product.price,
                    originalPrice: product.price,
                    image: product.image,
                    quantity: 1,
                    sku: product.sku,
                    size: size
                });
            }
            
            saveCart();
            updateBadges();
            showNotification(`${product.name} (${size}) –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
            const modal = document.querySelector('[style*="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5);"]');
            if (modal) modal.remove();
            
            if (currentPage === 'cart') {
                showPage('cart');
            }
        }
        
        function updateCartQuantity(productId, change, size = null) {
            const item = size ? 
                cart.find(item => item.id === productId && item.size === size) :
                cart.find(item => item.id === productId);
                
            if (!item) return;
            
            item.quantity += change;
            
            if (item.quantity <= 0) {
                cart = cart.filter(item => !(item.id === productId && item.size === (size || item.size)));
            }
            
            saveCart();
            updateBadges();
            showPage('cart');
        }
        
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
            
            if (currentUser && db) {
                try {
                    const userRef = db.collection('users').doc(currentUser.id);
                    userRef.update({
                        cart: cart,
                        cartUpdatedAt: new Date().toISOString()
                    });
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã:', error);
                }
            }
        }
        
        function getCartTotal() {
            return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        // ==================== –ò–ó–ë–†–ê–ù–ù–û–ï ====================
        function toggleFavorite(productId) {
            const index = favorites.indexOf(productId);
            
            if (index === -1) {
                favorites.push(productId);
                showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ ‚ù§Ô∏è');
            } else {
                favorites.splice(index, 1);
                showNotification('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateBadges();
            
            if (currentPage === 'favorites' || currentPage === 'catalog') {
                showPage(currentPage);
            }
        }

        // ==================== –°–¢–†–ê–ù–ò–¶–´ ====================
        function showPage(page) {
            currentPage = page;
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-page') === page) {
                    btn.classList.add('active');
                }
            });
            
            const content = document.getElementById('content');
            
            switch(page) {
                case 'catalog':
                    const filteredProducts = filterProducts(products);
                    const activeProducts = filteredProducts.filter(p => p.isActive !== false); // –ò–°–ü–†–ê–í–õ–ï–ù–û
                    const resultsCount = activeProducts.length;
                    
                    content.innerHTML = `
                        <div class="page-header">
                            <h1 class="page-title">–ü—Ä–µ–º–∏—É–º –∫–æ–ª–ª–µ–∫—Ü–∏—è</h1>
                            <button class="filter-toggle" onclick="openFilters()">
                                <i class="fas fa-sliders-h"></i> –§–∏–ª—å—Ç—Ä—ã
                            </button>
                        </div>
                        
                        <div class="results-counter">
                            <i class="fas fa-search"></i>
                            –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: <strong>${resultsCount}</strong>
                        </div>
                        
                        <div class="active-filters" id="activeFilters"></div>
                        
                        ${activeProducts.length > 0 ? `
                            <div class="products-grid" id="productsGrid">
                                ${activeProducts.map(product => renderProductCard(product)).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-search"></i>
                                </div>
                                <h2 class="empty-title">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h2>
                                <p class="empty-description">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</p>
                                <button onclick="clearFilters()" class="btn btn-primary">
                                    <i class="fas fa-times"></i> –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                                </button>
                                ${currentUser?.isAdmin ? `
                                    <button onclick="window.open('admin.html?userId=' + currentUser.id, '_blank')" class="btn btn-secondary mt-4">
                                        <i class="fas fa-crown"></i> –ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                                    </button>
                                ` : ''}
                            </div>
                        `}
                    `;
                    
                    renderActiveFilters();
                    break;
                    
                case 'favorites':
                    const favProducts = products.filter(p => favorites.includes(p.id) && p.isActive !== false); // –ò–°–ü–†–ê–í–õ–ï–ù–û
                    const filteredFavProducts = filterProducts(favProducts);
                    
                    content.innerHTML = `
                        <h1 class="page-title">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h1>
                        
                        ${filteredFavProducts.length > 0 ? `
                            <div class="results-counter">
                                <i class="fas fa-heart"></i>
                                –¢–æ–≤–∞—Ä–æ–≤ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º: <strong>${filteredFavProducts.length}</strong>
                            </div>
                            <div class="products-grid">
                                ${filteredFavProducts.map(product => renderProductCard(product)).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-heart"></i>
                                </div>
                                <h2 class="empty-title">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º –ø–æ–∫–∞ –ø—É—Å—Ç–æ</h2>
                                <p class="empty-description">–î–æ–±–∞–≤–ª—è–π—Ç–µ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è —Ç–æ–≤–∞—Ä—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</p>
                                <button onclick="showPage('catalog')" class="btn btn-primary">
                                    <i class="fas fa-store"></i> –ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω
                                </button>
                            </div>
                        `}
                    `;
                    break;
                    
                case 'cart':
                    content.innerHTML = `
                        <h1 class="page-title">–ö–æ—Ä–∑–∏–Ω–∞</h1>
                        
                        ${cart.length > 0 ? `
                            <div id="cartItems">
                                ${cart.map(item => `
                                    <div class="cart-item">
                                        <div class="cart-item-image">
                                            <img src="${item.image}" alt="${item.name}"
                                                 onerror="this.src='https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=200&h=200&fit=crop'">
                                        </div>
                                        <div class="cart-item-info">
                                            <div class="cart-item-name">${item.name}</div>
                                            <div class="cart-item-price">
                                                ${formatPrice(item.price)} √ó ${item.quantity}
                                                ${item.size ? `<br><small>–†–∞–∑–º–µ—Ä: ${item.size}</small>` : ''}
                                            </div>
                                        </div>
                                        <div class="cart-item-controls">
                                            <div class="quantity-control">
                                                <button class="qty-btn" onclick="updateCartQuantity('${item.id}', -1, '${item.size}')">-</button>
                                                <span class="qty-value">${item.quantity}</span>
                                                <button class="qty-btn" onclick="updateCartQuantity('${item.id}', 1, '${item.size}')">+</button>
                                            </div>
                                            <button class="remove-btn" onclick="updateCartQuantity('${item.id}', -${item.quantity}, '${item.size}')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="cart-summary">
                                <div class="summary-row">
                                    <span>–¢–æ–≤–∞—Ä—ã (${cart.reduce((sum, item) => sum + item.quantity, 0)} —à—Ç.)</span>
                                    <span>${formatPrice(getCartTotal())}</span>
                                </div>
                                <div class="summary-row">
                                    <span>–î–æ—Å—Ç–∞–≤–∫–∞</span>
                                    <span>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                                </div>
                                <div class="summary-row">
                                    <span>–ò—Ç–æ–≥–æ</span>
                                    <span>${formatPrice(getCartTotal())}</span>
                                </div>
                                <button onclick="startCheckout()" class="btn btn-primary btn-block mt-4">
                                    <i class="fas fa-shopping-bag"></i> –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                                </button>
                            </div>
                        ` : `
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-shopping-bag"></i>
                                </div>
                                <h2 class="empty-title">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
                                <p class="empty-description">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</p>
                                <button onclick="showPage('catalog')" class="btn btn-primary">
                                    <i class="fas fa-store"></i> –ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω
                                </button>
                            </div>
                        `}
                    `;
                    break;
                    
                case 'profile':
                    content.innerHTML = `
                        <div class="profile-header">
                            <div class="profile-avatar">
                                ${currentUser?.firstName?.[0]?.toUpperCase() || '–ü'}
                            </div>
                            <div class="profile-name">${currentUser?.firstName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
                            <div class="profile-username">${currentUser?.username || '–±–µ–∑ username'}</div>
                            ${currentUser?.isAdmin ? '<div style="margin-top: 1rem; padding: 0.5rem 1rem; background: var(--warning); color: white; border-radius: var(--radius-full); font-size: 0.75rem; font-weight: 600;"><i class="fas fa-crown"></i> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>' : ''}
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; margin-bottom: 1.5rem;">
                            <div style="background: var(--light); border-radius: var(--radius); border: 1px solid var(--gray-200); padding: 1rem; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.25rem;">${cart.reduce((sum, item) => sum + item.quantity, 0)}</div>
                                <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em;">–í –∫–æ—Ä–∑–∏–Ω–µ</div>
                            </div>
                            <div style="background: var(--light); border-radius: var(--radius); border: 1px solid var(--gray-200); padding: 1rem; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.25rem;">${favorites.length}</div>
                                <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
                            </div>
                            <div style="background: var(--light); border-radius: var(--radius); border: 1px solid var(--gray-200); padding: 1rem; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.25rem;">${userOrders.length}</div>
                                <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em;">–ó–∞–∫–∞–∑—ã</div>
                            </div>
                        </div>
                        
                        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                        <div class="profile-section">
                            <h3 class="section-title">
                                <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                            </h3>
                            <div style="display: grid; gap: 0.75rem;">
                                <div class="settings-option" onclick="openSettingsModal('notifications')">
                                    <div class="settings-option-content">
                                        <div class="settings-option-icon">
                                            <i class="fas fa-bell"></i>
                                        </div>
                                        <div class="settings-option-text">
                                            <div class="settings-option-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                                            <div class="settings-option-description">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right" style="color: var(--gray-400);"></i>
                                </div>
                                
                                <div class="settings-option" onclick="openPrivacyModal()">
                                    <div class="settings-option-content">
                                        <div class="settings-option-icon">
                                            <i class="fas fa-shield-alt"></i>
                                        </div>
                                        <div class="settings-option-text">
                                            <div class="settings-option-title">–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å</div>
                                            <div class="settings-option-description">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏</div>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right" style="color: var(--gray-400);"></i>
                                </div>
                                
                                <div class="settings-option" onclick="clearLocalData()">
                                    <div class="settings-option-content">
                                        <div class="settings-option-icon" style="background: rgba(239, 68, 68, 0.1); color: var(--error);">
                                            <i class="fas fa-trash"></i>
                                        </div>
                                        <div class="settings-option-text">
                                            <div class="settings-option-title">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</div>
                                            <div class="settings-option-description">–£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right" style="color: var(--gray-400);"></i>
                                </div>
                                
                                ${currentUser?.isAdmin ? `
                                    <div class="settings-option" onclick="openAdminPanel()">
                                        <div class="settings-option-content">
                                            <div class="settings-option-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">
                                                <i class="fas fa-crown"></i>
                                            </div>
                                            <div class="settings-option-text">
                                                <div class="settings-option-title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
                                                <div class="settings-option-description">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
                                            </div>
                                        </div>
                                        <i class="fas fa-chevron-right" style="color: var(--gray-400);"></i>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- –°–µ–∫—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ -->
                        <div class="profile-section">
                            <h3 class="section-title">
                                <i class="fas fa-receipt"></i> –ú–æ–∏ –∑–∞–∫–∞–∑—ã
                            </h3>
                            ${userOrders.length > 0 ? userOrders.map(order => `
                                <div class="order-card">
                                    <div class="order-header">
                                        <div class="order-number">–ó–∞–∫–∞–∑ #${order.id.substring(0, 8)}</div>
                                        <div class="order-status" style="
                                            background: ${getOrderStatusColor(order.status)};
                                            color: white;
                                        ">
                                            ${getOrderStatusText(order.status)}
                                        </div>
                                    </div>
                                    <div class="order-items">
                                        ${order.items ? order.items.slice(0, 2).map(item => 
                                            `${item.name} √ó ${item.quantity}`
                                        ).join(', ') : '–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤'}
                                        ${order.items && order.items.length > 2 ? ` –∏ –µ—â–µ ${order.items.length - 2}` : ''}
                                    </div>
                                    <div class="order-total">${formatPrice(order.total || 0)}</div>
                                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.5rem;">
                                        ${formatDate(order.createdAt)}
                                    </div>
                                </div>
                            `).join('') : `
                                <div style="text-align: center; padding: 2rem;">
                                    <i class="fas fa-receipt" style="font-size: 2rem; color: var(--gray-300); margin-bottom: 1rem;"></i>
                                    <div style="color: var(--gray-600);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>
                                    <button onclick="showPage('catalog')" class="btn btn-primary mt-4">
                                        <i class="fas fa-store"></i> –°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑
                                    </button>
                                </div>
                            `}
                        </div>
                    `;
                    break;
            }
        }
        
        function getOrderStatusText(status) {
            const statuses = {
                'created': '–°–æ–∑–¥–∞–Ω',
                'processing': '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
                'confirmed': '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω',
                'shipped': '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω',
                'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω',
                'cancelled': '–û—Ç–º–µ–Ω–µ–Ω'
            };
            return statuses[status] || status;
        }
        
        function getOrderStatusColor(status) {
            const colors = {
                'created': 'var(--info)',
                'processing': 'var(--warning)',
                'confirmed': 'var(--success)',
                'shipped': 'var(--primary)',
                'delivered': 'var(--success)',
                'cancelled': 'var(--error)'
            };
            return colors[status] || 'var(--gray-500)';
        }
        
        function openAdminPanel() {
            if (currentUser && currentUser.isAdmin) {
                window.open('admin.html?userId=' + currentUser.id, '_blank');
            } else {
                showNotification('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω', 'error');
            }
        }
        
        async function startCheckout() {
            if (cart.length === 0) {
                showNotification('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞', 'error');
                return;
            }
            
            const content = document.getElementById('content');
            content.innerHTML = `
                <h1 class="page-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
                
                <div class="checkout-form">
                    <div class="form-group">
                        <label class="form-label">–ò–º—è *</label>
                        <input type="text" class="form-control" id="checkoutName" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                        <input type="tel" class="form-control" id="checkoutPhone" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="checkoutEmail">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ *</label>
                        <input type="text" class="form-control" id="checkoutAddress" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
                        <textarea class="form-control" id="checkoutComment" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</label>
                        <select class="form-control" id="checkoutPayment">
                            <option value="card">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</option>
                            <option value="cash">–ù–∞–ª–∏—á–Ω—ã–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</option>
                            <option value="transfer">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥</option>
                        </select>
                    </div>
                    
                    <div class="cart-summary">
                        <div class="summary-row">
                            <span>–¢–æ–≤–∞—Ä—ã (${cart.reduce((sum, item) => sum + item.quantity, 0)} —à—Ç.)</span>
                            <span>${formatPrice(getCartTotal())}</span>
                        </div>
                        <div class="summary-row">
                            <span>–î–æ—Å—Ç–∞–≤–∫–∞</span>
                            <span>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                        </div>
                        <div class="summary-row">
                            <span>–ò—Ç–æ–≥–æ</span>
                            <span>${formatPrice(getCartTotal())}</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
                        <button class="btn btn-secondary" onclick="showPage('cart')" style="flex: 1;">
                            <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                        </button>
                        <button class="btn btn-primary" onclick="submitOrder()" style="flex: 2;">
                            <i class="fas fa-check"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑
                        </button>
                    </div>
                </div>
            `;
        }
        
        async function submitOrder() {
            const name = document.getElementById('checkoutName').value.trim();
            const phone = document.getElementById('checkoutPhone').value.trim();
            const email = document.getElementById('checkoutEmail').value.trim();
            const address = document.getElementById('checkoutAddress').value.trim();
            const comment = document.getElementById('checkoutComment').value.trim();
            const payment = document.getElementById('checkoutPayment').value;
            
            if (!name || !phone || !address) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            try {
                // –°–æ–∑–¥–∞–µ–º –∑–∞–∫–∞–∑
                const orderData = {
                    userId: currentUser?.id || 'guest',
                    userName: name,
                    userPhone: phone,
                    userEmail: email || '',
                    address: address,
                    comment: comment || '',
                    paymentMethod: payment,
                    items: cart.map(item => ({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        originalPrice: item.originalPrice,
                        quantity: item.quantity,
                        size: item.size,
                        sku: item.sku,
                        image: item.image
                    })),
                    total: getCartTotal(),
                    status: 'created',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
                const orderRef = await db.collection('orders').add(orderData);
                const orderId = orderRef.id;
                
                // –î–æ–±–∞–≤–ª—è–µ–º ID –∑–∞–∫–∞–∑–∞ –≤ –¥–∞–Ω–Ω—ã–µ
                await orderRef.update({ id: orderId });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–¥–∞–∂ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
                for (const item of cart) {
                    const productRef = db.collection('products').doc(item.id);
                    const productDoc = await productRef.get();
                    
                    if (productDoc.exists) {
                        const productData = productDoc.data();
                        await productRef.update({
                            purchases: (productData.purchases || 0) + item.quantity,
                            updatedAt: new Date().toISOString()
                        });
                    }
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                userOrders.unshift({
                    ...orderData,
                    id: orderId
                });
                localStorage.setItem('userOrders', JSON.stringify(userOrders));
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
                await sendTelegramNotification(orderId, orderData);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram
                if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    await sendTelegramMessageToUser(
                        tg.initDataUnsafe.user.id,
                        `‚úÖ –í–∞—à –∑–∞–∫–∞–∑ #${orderId.substring(0, 8)} —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω!\n\n` +
                        `üí∞ –°—É–º–º–∞: ${formatPrice(orderData.total)}\n` +
                        `üöö –ê–¥—Ä–µ—Å: ${address}\n` +
                        `üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n\n` +
                        `–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.`
                    );
                }
                
                // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
                cart = [];
                saveCart();
                updateBadges();
                
                showNotification('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω!', 'success');
                showPage('profile');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞', 'error');
            }
        }
        
        async function sendTelegramNotification(orderId, orderData) {
            try {
                const itemsList = orderData.items.map(item => 
                    `- ${item.name} (${item.size}) √ó ${item.quantity} = ${formatPrice(item.price * item.quantity)}`
                ).join('\n');
                
                const message = `
üõí *–ù–û–í–´–ô –ó–ê–ö–ê–ó #${orderId.substring(0, 8)}*

üë§ *–ü–æ–∫—É–ø–∞—Ç–µ–ª—å:* ${orderData.userName}
üìû *–¢–µ–ª–µ—Ñ–æ–Ω:* ${orderData.userPhone}
${orderData.userEmail ? `üìß *Email:* ${orderData.userEmail}\n` : ''}
üìç *–ê–¥—Ä–µ—Å:* ${orderData.address}
üí≥ *–û–ø–ª–∞—Ç–∞:* ${getPaymentMethodText(orderData.paymentMethod)}
${orderData.comment ? `üí≠ *–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:* ${orderData.comment}\n` : ''}

üì¶ *–¢–æ–≤–∞—Ä—ã:*
${itemsList}

üí∞ *–ò—Ç–æ–≥–æ:* ${formatPrice(orderData.total)}

üïê *–î–∞—Ç–∞:* ${formatDate(orderData.createdAt)}
                `;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram –±–æ—Ç
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: 1079922982, // ID –≤–∞—à–µ–≥–æ —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });
                
                if (!response.ok) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', await response.text());
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram:', error);
            }
        }
        
        async function sendTelegramMessageToUser(userId, message) {
            try {
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: userId,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });
                
                if (!response.ok) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:', await response.text());
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram:', error);
            }
        }
        
        function getPaymentMethodText(method) {
            const methods = {
                'card': '–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞',
                'cash': '–ù–∞–ª–∏—á–Ω—ã–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏',
                'transfer': '–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥'
            };
            return methods[method] || method;
        }
        
        function clearLocalData() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ? –ö–æ—Ä–∑–∏–Ω–∞, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                localStorage.clear();
                cart = [];
                favorites = [];
                userOrders = [];
                userSettings = {
                    notifications: {
                        newProducts: true,
                        promotions: true,
                        orderUpdates: true,
                        stockAlerts: true
                    },
                    privacy: {
                        showProfile: true,
                        showOrders: true,
                        showActivity: false,
                        shareData: false
                    },
                    preferences: {
                        currency: 'RUB',
                        language: 'ru',
                        theme: 'light'
                    }
                };
                updateBadges();
                showNotification('–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
                showPage('profile');
            }
        }

        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        function formatPrice(price) {
            return new Intl.NumberFormat('ru-RU').format(price) + ' ‚ÇΩ';
        }
        
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function updateBadges() {
            const cartCount = cart.reduce((sum, item) => sum + item.quantity, 0);
            const favCount = favorites.length;
            
            const cartBadge = document.getElementById('cartBadge');
            const favBadge = document.getElementById('favBadge');
            
            if (cartBadge) {
                if (cartCount > 0) {
                    cartBadge.textContent = cartCount > 9 ? '9+' : cartCount;
                    cartBadge.style.display = 'flex';
                } else {
                    cartBadge.style.display = 'none';
                }
            }
            
            if (favBadge) {
                if (favCount > 0) {
                    favBadge.textContent = favCount > 9 ? '9+' : favCount;
                    favBadge.style.display = 'flex';
                } else {
                    favBadge.style.display = 'none';
                }
            }
        }
        
        function showNotification(message, type = 'success') {
            const oldNotifications = document.querySelectorAll('.notification');
            oldNotifications.forEach(notif => notif.remove());
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            switch(type) {
                case 'error':
                    notification.style.background = 'var(--error)';
                    break;
                case 'warning':
                    notification.style.background = 'var(--warning)';
                    break;
                case 'info':
                    notification.style.background = 'var(--gray-700)';
                    break;
                default:
                    notification.style.background = 'var(--success)';
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ==================== –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', initApp);
        
        window.addEventListener('beforeunload', () => {
            if (currentUser && db && isInitialized) {
                saveCart();
                saveUserSettings();
            }
        });
    </script>
</body>
</html>
